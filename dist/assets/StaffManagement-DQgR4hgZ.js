import{k as D,a2 as N,aT as O,ac as Q,a1 as E,g as s,q as L,l as e,av as k,aw as z,ax as R,aa as J,ay as M,B as T,am as P,z as y,L as K,aU as $,a0 as W,T as V,Q as X}from"./index-CZBwRkMB.js";import{C as Z,A as ee}from"./CustomButton-aXW950y9.js";import{u as te,a as ae}from"./user.apis-C84GvXQt.js";import{P as se}from"./PaginationComponent-6LQ412tG.js";import{C as B}from"./CrudButtonComponent-DO3oJB3V.js";import{T as re,S as ne}from"./tableHeader-CRmfiMtu.js";import{e as F}from"./dataConverter-Dy8MubmD.js";import{F as le,I as oe,S as ie}from"./Select-Brq7J5Hy.js";import{M as ce}from"./MenuItem-DxENn0FA.js";import{S as Y}from"./Snackbar-DvFOCUZb.js";import{B as A}from"./Box-C_9pThu7.js";import{T as v}from"./TextField-CYZD3Swe.js";import"./dateTimeUtils-BcV6LRrk.js";import"./format-BOZTN9QO.js";import"./useFormControl-DCod055n.js";import"./dividerClasses-CTA8xlXU.js";import"./ClickAwayListener-PCP8-beJ.js";const de=async(l,n)=>{try{if((await D.delete(`${N}/staffs/${l}`,{headers:{Authorization:`Bearer ${n}`}})).status!==200)throw new Error("Failed to delete staff")}catch(i){O(i,E.DELETE_STAFF_ERROR,!1,E.DELETE_STAFF_ERROR)}},ue=async(l,n,i)=>{try{if((await D.put(`${N}/staffs/${l}`,n,{headers:{Authorization:`Bearer ${i}`}})).status!==200)throw new Error("Failed to update staff")}catch(t){O(t,E.UPDATE_STAFF_ERROR,!1,E.UPDATE_STAFF_ERROR)}},me=async l=>{try{const n=await D.get(`${N}/staffs/${l}`,{headers:{Authorization:`Bearer ${Q()}`}});if(n.status!==200)throw new Error("Failed to fetch staff data");return n.data}catch(n){O(n,E.FETCH_STAFF_ERROR,!1,E.FETCH_STAFF_ERROR)}};function he({apiUrl:l,itemsPerPage:n,accessToken:i}){const[t,g]=s.useState([]),[h,x]=s.useState(!0),[_,p]=s.useState(null),[c,j]=s.useState(1),[b,S]=s.useState(0),[C,d]=s.useState(0),f=s.useCallback(async()=>{try{x(!0);const a=i?{Authorization:`Bearer ${i}`}:{},m=(await D.get(l,{params:{page:c-1,limit:n},headers:a})).data;m&&Array.isArray(m.item)?(g(m.item),S(m.total_item),d(m.total_page),p(null)):p("Error fetching items")}catch{p("Error fetching items")}finally{x(!1)}},[l,c,n,i]);return s.useEffect(()=>{f()},[f]),{items:t,loading:h,error:_,page:c,totalItems:b,totalPages:C,handlePageChange:(a,o)=>{j(o)},refetch:f}}const xe=({open:l,onClose:n,onInputChange:i})=>{const[t,g]=s.useState([]),[h,x]=s.useState(""),[_,p]=s.useState(!1),[c,j]=s.useState(!1),[b,S]=s.useState(""),C=L(),d=async()=>{const a=P("access_token");if(!a){C("/login");return}p(!0);try{const o=await D.get(`${N}/members`,{headers:{Authorization:`Bearer ${a}`},params:{page:0,limit:50}});g(o.data.item)}catch(o){console.error("Error fetching staff list:",o)}finally{p(!1)}},f=async a=>{if(a&&a.preventDefault(),!h){y.error("Please select a member before submitting");return}try{await te(parseInt(h),2),S("Member updated to staff successfully"),j(!0),n()}catch(o){const m=F(o,"Failed to update member to staff");console.error(m),y.error(m)}};s.useEffect(()=>{l&&d()},[l]);const u=a=>{x(a.target.value),i("auctioneer_id",a.target.value)};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{open:l,onClose:n,maxWidth:"sm",fullWidth:!0,children:[e.jsx(z,{children:"Update Current Member to Staff"}),e.jsxs(R,{children:[e.jsxs(le,{fullWidth:!0,variant:"standard",margin:"dense",children:[e.jsx(oe,{id:"auctioneer-select-label",children:"Member"}),e.jsx(ie,{labelId:"auctioneer-select-label",id:"auctioneer-select",name:"auctioneer_id",value:h,onChange:u,label:"Auctioneer",children:t.map(a=>e.jsx(ce,{value:a.id,children:`ID: ${a.id} - ${a.first_name} ${a.last_name}`},a.id))})]}),_&&e.jsx(J,{})]}),e.jsxs(M,{children:[e.jsx(T,{onClick:n,children:"Cancel"}),e.jsx(T,{onClick:a=>f(a),variant:"contained",color:"primary",disabled:_,children:_?"Submitting...":"Submit"})]})]}),e.jsx(Y,{open:c,autoHideDuration:6e3,onClose:()=>j(!1),message:b})]})},H={readOnly:!0},pe=({open:l,onClose:n,staffId:i})=>{const[t,g]=s.useState(null),[h,x]=s.useState(!0),[_,p]=s.useState(null),[c,j]=s.useState({open:!1,message:""}),b=L();s.useEffect(()=>{l&&C()},[l,i]);const S=()=>{const u=P("access_token");return u||(b("/notfound"),null)},C=async()=>{if(x(!0),!!S())try{const a=await me(i);g(a)}catch(a){const o=F(a,"Failed to fetch staff data");y.error(o),p(o)}finally{x(!1)}},d=u=>{const{name:a,value:o}=u.target;g(m=>m?{...m,[a]:o}:null)},f=async()=>{if(!t)return;const u=S();if(u)try{await ue(i,t,u),j({open:!0,message:"Staff updated successfully"}),n()}catch(a){const o=F(a,"Failed to update staff");y.error(o),p(o)}};return h?e.jsx(k,{open:l,onClose:n,children:e.jsx(R,{children:e.jsx(A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(K,{})})})}):_?e.jsxs(k,{open:l,onClose:n,children:[e.jsx(R,{children:e.jsx(A,{sx:{color:"error.main"},children:_})}),e.jsx(M,{children:e.jsx(T,{onClick:n,children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{open:l,onClose:n,maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:"Edit Staff Member"}),e.jsx(R,{children:e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsxs(A,{sx:{display:"flex",gap:2},children:[e.jsx(v,{name:"first_name",label:"First Name",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.first_name)??"",onChange:d}),e.jsx(v,{name:"last_name",label:"Last Name",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.last_name)??"",onChange:d})]}),e.jsxs(A,{sx:{display:"flex",gap:2},children:[e.jsx(v,{name:"email",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.email)??"",onChange:d,inputProps:H}),e.jsx(v,{name:"phone_number",label:"Phone Number",type:"tel",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.phone_number)??"",onChange:d,inputProps:H})]}),e.jsx(v,{name:"address",label:"Address",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.address)??"",onChange:d}),e.jsxs(A,{sx:{display:"flex",gap:2},children:[e.jsx(v,{name:"date_of_birth",label:"Date of Birth",type:"date",fullWidth:!0,variant:"outlined",InputLabelProps:{shrink:!0},value:(t==null?void 0:t.date_of_birth)??"",onChange:d}),e.jsx(v,{name:"avatar_url",label:"Avatar URL",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.avatar_url)??"",onChange:d})]})]})}),e.jsxs(M,{children:[e.jsx(T,{onClick:n,children:"Cancel"}),e.jsx(T,{onClick:f,variant:"contained",color:"primary",children:"Update"})]})]}),e.jsx(Y,{open:c.open,autoHideDuration:6e3,onClose:()=>j({...c,open:!1}),message:c.message})]})},we=()=>{const[l,n]=s.useState(!1),[i,t]=s.useState(!1),[g,h]=s.useState(null),x=L(),[_,p]=s.useState({first_name:"",last_name:"",phone_number:"",email:"",password:"",is_active:!0,is_subscription:!0,address:"",date_of_birth:"",avatar_url:""}),c=P("access_token");s.useEffect(()=>{c||x("/notfound")},[c,x]);const{items:j,page:b,totalPages:S,totalItems:C,handlePageChange:d,refetch:f}=he({apiUrl:`${N}/staffs`,itemsPerPage:20,accessToken:c});if(!c)return null;const u=s.useCallback(async r=>{if(window.confirm(`${$.ARE_YOU_SURE_YOU_WANT_TO_DELETE_THIS_STAFF}?`))try{await de(r,c),y.success(W.DELETE_STAFF_SUCCESS),f()}catch(w){const I=F(w,E.DELETE_STAFF_FAILED);y.error(I)}},[c,f]),a=async r=>{if(confirm(`${$.ARE_YOU_SURE_YOU_WANT_TO_REDO_THIS_STAFF} ${r}`))try{await ae(r),y.success(W.REDO_STAFF_SUCCESS)}catch(w){const I=F(w,E.REDO_STAFF_FAILED);y.error(I)}};s.useCallback(r=>{h(r),t(!0)},[]);const o=s.useCallback(()=>{t(!1),h(null)},[]),m=s.useCallback(()=>n(!0),[]),G=s.useCallback(()=>n(!1),[]),q=(r,U)=>{};return e.jsxs("div",{className:"m-5 overflow-x-auto",children:[e.jsxs("div",{className:"mb-6 flex justify-between",children:[e.jsx("div",{className:"border-2 border-sky-500 p-6 rounded-xl",children:e.jsxs(V,{variant:"h5",children:["Total Staff: ",C]})}),e.jsxs(Z,{onClick:m,children:[e.jsx(ee,{className:"mr-2"}),"New Staff"]})]}),e.jsx(xe,{open:l,onClose:G,onInputChange:q}),e.jsxs("table",{className:"whitespace-no-wrap w-full",children:[e.jsx(re,{headers:ne}),e.jsxs("tbody",{className:"divide-y bg-white dark:divide-gray-700 dark:bg-gray-800",children:[j.map(r=>e.jsxs("tr",{className:"text-gray-700 dark:text-gray-400",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:r.id}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center text-sm",children:e.jsx("div",{className:"relative mr-3 hidden h-8 w-8 rounded-full md:block",children:e.jsx("img",{className:"h-full w-full rounded-full object-cover",src:r.avatar_url,alt:"",loading:"lazy"})})})}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[r.first_name," ",r.last_name]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.phone_number||"Not provided"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.address}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.status_name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.is_active}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.is_subscription}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.date_of_birth}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.account_balance}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.auction_count}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.created_at}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.updated_at}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsx(B,{onClick:()=>u(r.id),ariaLabel:"Delete",svgPath:"delete.svg"}),e.jsx(B,{onClick:()=>a(r.id),ariaLabel:"Redo breeder",svgPath:"redo.svg"})]})})]},r.id)),g&&e.jsx(pe,{open:i,onClose:o,staffId:g})]})]}),e.jsx("div",{className:"xs:flex-row xs:justify-between flex flex-col items-center border-t bg-white px-5 py-5",children:e.jsx(se,{totalPages:S,currentPage:b,onPageChange:d})}),e.jsx(X,{})]})};export{we as default};
