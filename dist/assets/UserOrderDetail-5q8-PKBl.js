import{H as ne,I as ie,g as l,J as pe,K as _e,T as a,k as e,N as re,P as L,U as J,V as le,X as de,F as q,W as Pe,aF as Ie,Y as me,Z as xe,aG as Ne,aH as Oe,aI as Me,o as Ae,B as A,ai as X,x as I,ap as ee,aJ as ke,a5 as Le,j as Be,aD as Ge,aq as $e,aE as ze,a4 as Te,L as Ve,aK as We,aL as Ue,aM as qe,Q as He,aB as Ye}from"./index-CvZ0wdb0.js";import{E as Re}from"./Edit-CnquUs31.js";import{O as F}from"./orders.type-CY8k0T_M.js";import{f as Ke,a as Qe,b as fe,u as Je,c as Ze}from"./order.apis-Dz1cBfNL.js";import{R as ge,g as Xe,s as et}from"./feedback.apis-G3uOCXvL.js";import{A as tt}from"./Alert-CGMiffud.js";import{B as f}from"./Box-CMC4TlbO.js";import{T as K}from"./TextField-DmIMr6K4.js";import{k as rt}from"./koibreeders-C8vjzIiM.js";import{f as H}from"./currencyUtils-DiCxv8hG.js";import{D as st}from"./Divider-B5cCF6n7.js";import{u as ue}from"./useFormControl-Cz7kLNRm.js";import{f as Ee,F as se,I as oe,S as ae}from"./Select-D5OM6xxo.js";import{S as ot}from"./SwitchBase-B2koKQhy.js";import{G as U,D as at}from"./Grid-BCuxEvtb.js";import{M as te}from"./MenuItem-4CYdLiSI.js";import{f as ye,a as be}from"./format-BOZTN9QO.js";import{c as nt}from"./payment.apis-Dv3GJbEk.js";import{u as it}from"./index-CKxQ85Ol.js";import"./environment-DLtSd3s7.js";import"./dividerClasses-D9IiBztf.js";function lt(t){return ie("MuiFormControlLabel",t)}const Z=ne("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),dt=t=>{const{classes:r,disabled:d,labelPlacement:i,error:h,required:j}=t,v={root:["root",d&&"disabled",`labelPlacement${J(i)}`,h&&"error",j&&"required"],label:["label",d&&"disabled"],asterisk:["asterisk",h&&"error"]};return le(v,lt,r)},ct=L("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:d}=t;return[{[`& .${Z.label}`]:r.label},r.root,r[`labelPlacement${J(d.labelPlacement)}`]]}})(de(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${Z.disabled}`]:{cursor:"default"},[`& .${Z.label}`]:{[`&.${Z.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:r})=>r==="start"||r==="top"||r==="bottom",style:{marginLeft:16}}]}))),pt=L("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,r)=>r.asterisk})(de(({theme:t})=>({[`&.${Z.error}`]:{color:(t.vars||t).palette.error.main}}))),ve=l.forwardRef(function(r,d){const i=pe({props:r,name:"MuiFormControlLabel"}),{checked:h,className:j,componentsProps:v={},control:y,disabled:C,disableTypography:_,inputRef:N,label:c,labelPlacement:b="end",name:m,onChange:n,required:P,slots:B={},slotProps:R={},value:w,...E}=i,O=ue(),z=C??y.props.disabled??(O==null?void 0:O.disabled),k=P??y.props.required,u={disabled:z,required:k};["checked","name","onChange","value","inputRef"].forEach(g=>{typeof y.props[g]>"u"&&typeof i[g]<"u"&&(u[g]=i[g])});const G=Ee({props:i,muiFormControl:O,states:["error"]}),D={...i,disabled:z,labelPlacement:b,required:k,error:G.error},M=dt(D),$={slots:B,slotProps:{...v,...R}},[W,o]=_e("typography",{elementType:a,externalForwardedProps:$,ownerState:D});let p=c;return p!=null&&p.type!==a&&!_&&(p=e.jsx(W,{component:"span",...o,className:re(M.label,o==null?void 0:o.className),children:p})),e.jsxs(ct,{className:re(M.root,j),ownerState:D,ref:d,...E,children:[l.cloneElement(y,u),k?e.jsxs("div",{children:[p,e.jsxs(pt,{ownerState:D,"aria-hidden":!0,className:M.asterisk,children:["â€‰","*"]})]}):p]})});function ut(t){return ie("MuiFormGroup",t)}ne("MuiFormGroup",["root","row","error"]);const ht=t=>{const{classes:r,row:d,error:i}=t;return le({root:["root",d&&"row",i&&"error"]},ut,r)},mt=L("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:d}=t;return[r.root,d.row&&r.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),xt=l.forwardRef(function(r,d){const i=pe({props:r,name:"MuiFormGroup"}),{className:h,row:j=!1,...v}=i,y=ue(),C=Ee({props:i,muiFormControl:y,states:["error"]}),_={...i,row:j,error:C.error},N=ht(_);return e.jsx(mt,{className:re(N.root,h),ownerState:_,ref:d,...v})}),ft=q(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),gt=q(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),yt=L("span",{shouldForwardProp:Pe})({position:"relative",display:"flex"}),bt=L(ft)({transform:"scale(1)"}),vt=L(gt)(de(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function Fe(t){const{checked:r=!1,classes:d={},fontSize:i}=t,h={...t,checked:r};return e.jsxs(yt,{className:d.root,ownerState:h,children:[e.jsx(bt,{fontSize:i,className:d.background,ownerState:h}),e.jsx(vt,{fontSize:i,className:d.dot,ownerState:h})]})}const De=l.createContext(void 0);function jt(){return l.useContext(De)}function Ct(t){return ie("MuiRadio",t)}const je=ne("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),St=t=>{const{classes:r,color:d,size:i}=t,h={root:["root",`color${J(d)}`,i!=="medium"&&`size${J(i)}`]};return{...r,...le(h,Ct,r)}},wt=L(ot,{shouldForwardProp:t=>Pe(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:d}=t;return[r.root,d.size!=="medium"&&r[`size${J(d.size)}`],r[`color${J(d.color)}`]]}})(de(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${je.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:me(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(xe()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:me(t.palette[r].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(xe()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${je.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function _t(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const Pt=e.jsx(Fe,{checked:!0}),kt=e.jsx(Fe,{}),Ce=l.forwardRef(function(r,d){const i=pe({props:r,name:"MuiRadio"}),{checked:h,checkedIcon:j=Pt,color:v="primary",icon:y=kt,name:C,onChange:_,size:N="medium",className:c,disabled:b,disableRipple:m=!1,slots:n={},slotProps:P={},inputProps:B,...R}=i,w=ue();let E=b;w&&typeof E>"u"&&(E=w.disabled),E??(E=!1);const O={...i,disabled:E,disableRipple:m,color:v,size:N},z=St(O),k=jt();let u=h;const G=Ie(_,k&&k.onChange);let D=C;k&&(typeof u>"u"&&(u=_t(k.value,i.value)),typeof D>"u"&&(D=k.name));const M=P.input??B,[$,W]=_e("root",{ref:d,elementType:wt,className:re(z.root,c),shouldForwardComponentProp:!0,externalForwardedProps:{slots:n,slotProps:P,...R},getSlotProps:o=>({...o,onChange:(p,...g)=>{var S;(S=o.onChange)==null||S.call(o,p,...g),G(p,...g)}}),ownerState:O,additionalProps:{type:"radio",icon:l.cloneElement(y,{fontSize:y.props.fontSize??N}),checkedIcon:l.cloneElement(j,{fontSize:j.props.fontSize??N}),disabled:E,name:D,checked:u,slots:n,slotProps:{input:typeof M=="function"?M(O):M}}});return e.jsx($,{...W,classes:z})});function Rt(t){return ie("MuiRadioGroup",t)}ne("MuiRadioGroup",["root","row","error"]);const Et=t=>{const{classes:r,row:d,error:i}=t;return le({root:["root",d&&"row",i&&"error"]},Rt,r)},Ft=l.forwardRef(function(r,d){const{actions:i,children:h,className:j,defaultValue:v,name:y,onChange:C,value:_,...N}=r,c=l.useRef(null),b=Et(r),[m,n]=Ne({controlled:_,default:v,name:"RadioGroup"});l.useImperativeHandle(i,()=>({focus:()=>{let w=c.current.querySelector("input:not(:disabled):checked");w||(w=c.current.querySelector("input:not(:disabled)")),w&&w.focus()}}),[]);const P=Oe(d,c),B=Me(y),R=l.useMemo(()=>({name:B,onChange(w){n(w.target.value),C&&C(w,w.target.value)},value:m}),[B,C,n,m]);return e.jsx(De.Provider,{value:R,children:e.jsx(xt,{role:"radiogroup",ref:P,className:re(b.root,j),...N,children:h})})}),Se=q(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment"),Dt=q(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),It=({orderId:t})=>{const[r,d]=l.useState(null),[i,h]=l.useState(0),[j,v]=l.useState(""),[y,C]=l.useState(null),_=Ae();l.useEffect(()=>{(async()=>{try{if(t){const b=await Ke(Number(t),X()||"");if(d(b),b.status===F.DELIVERED){const m=await Xe(Number(t),X()||"");m&&(C(m),h(m.rating),v(m.content))}}}catch(b){console.error("Error fetching order and feedback:",b),I.error("Failed to fetch order details or feedback")}})()},[t]);const N=async c=>{var b;if(c.preventDefault(),!i){I.error("Please provide a rating");return}try{const m={content:j,rating:i,order_id:Number(t),user_id:((b=_==null?void 0:_.user)==null?void 0:b.id)||0};await et(m,X()||""),I.success("Feedback submitted successfully"),C(m)}catch(m){console.error("Error submitting feedback:",m),I.error("Failed to submit feedback")}};return r?r.status!==F.DELIVERED?e.jsx(tt,{severity:"info",children:"Feedback can only be submitted for delivered orders."}):y?e.jsxs(f,{children:[e.jsx(a,{variant:"h5",gutterBottom:!0,children:"Your Feedback"}),e.jsxs(f,{sx:{mb:3},children:[e.jsx(a,{component:"legend",children:"Rating"}),e.jsx(ge,{name:"read-only",value:y.rating,readOnly:!0})]}),e.jsx(a,{variant:"body1",gutterBottom:!0,children:y.content})]}):e.jsxs(f,{children:[e.jsx(a,{variant:"h5",gutterBottom:!0,children:"Leave Feedback"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs(f,{sx:{mb:3},children:[e.jsx(a,{component:"legend",children:"Rating"}),e.jsx(ge,{name:"rating",value:i,onChange:(c,b)=>{h(b)}})]}),e.jsx(K,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",label:"Your Feedback",value:j,onChange:c=>v(c.target.value),sx:{mb:3}}),e.jsx(A,{type:"submit",variant:"contained",color:"primary",children:"Submit Feedback"})]})]}):e.jsx(a,{children:"Loading..."})},Nt=q(e.jsx("path",{d:"M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-8 4c0 .55-.45 1-1 1s-1-.45-1-1V8h2zm2-6c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2m4 6c0 .55-.45 1-1 1s-1-.45-1-1V8h2z"}),"ShoppingBag"),Ot=q(e.jsx("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),Mt=q(e.jsx("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping"),At=q(e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn"),Lt=t=>{try{const r=t.split(", ");return{street_address:r[0]||"",ward:r[1]||"",ward_code:"",district:r[2]||"",district_code:"",province:r[3]||"",province_code:""}}catch{return{street_address:"",ward:"",ward_code:"",district:"",district_code:"",province:"",province_code:""}}},we=t=>`${t.street_address}, ${t.ward}, ${t.district}, ${t.province}`.trim(),Q={standard:5e5,express:1e6},Bt=({order:t,onTempUpdate:r,onSave:d})=>{const[i,h]=l.useState(!1),[j,v]=l.useState([]),[y,C]=l.useState([]),[_,N]=l.useState([]),[c,b]=l.useState(Lt(t.shipping_address)),[m,n]=l.useState(t.shipping_method==="Express"?"Express":"Standard"),[P,B]=l.useState(t.phone_number),[R,w]=l.useState(t.first_name),[E,O]=l.useState(t.last_name);l.useEffect(()=>{(async()=>{try{const g=await(await fetch("https://provinces.open-api.vn/api/p/")).json();v(g)}catch(p){console.error("Error fetching provinces:",p)}})()},[]);const z=async o=>{const p=o.target.value,g=j.find(S=>S.code===p);b({...c,province:(g==null?void 0:g.name)||"",province_code:p,district:"",district_code:"",ward:"",ward_code:""});try{const T=await(await fetch(`https://provinces.open-api.vn/api/p/${p}?depth=2`)).json();C(T.districts)}catch(S){console.error("Error fetching districts:",S)}},k=async o=>{const p=o.target.value,g=y.find(S=>S.code===p);b({...c,district:(g==null?void 0:g.name)||"",district_code:p,ward:"",ward_code:""});try{const T=await(await fetch(`https://provinces.open-api.vn/api/d/${p}?depth=2`)).json();N(T.wards)}catch(S){console.error("Error fetching wards:",S)}},u=o=>{const p=o.target.value,g=_.find(S=>S.code===p);b({...c,ward:(g==null?void 0:g.name)||"",ward_code:p})},G=o=>ye(be(new Date,o==="Standard"?7:3),"MMM dd, yyyy"),D=/^\d{10}$/,M=()=>{const o=we(c),p=ye(be(new Date,m==="Standard"?7:3),"yyyy-MM-dd");r({shipping_address:o,shipping_method:m,shipping_date:p}),h(!1)},$=()=>R.trim()!==""&&E.trim()!==""&&c.street_address.trim()!==""&&c.province_code!==""&&c.district_code!==""&&c.ward_code!==""&&D.test(P),W=o=>{if(t.status!==F.PENDING)return;const p=o.target.value;n(p),r({shipping_method:p})};return e.jsxs(ee,{sx:{p:3,mb:2},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsxs(a,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(At,{})," Shipping Information"]}),t.status===F.PENDING&&e.jsx(A,{startIcon:e.jsx(Re,{}),onClick:()=>h(!0),children:"Edit"})]}),e.jsxs(f,{sx:{mb:3},children:[e.jsx(a,{variant:"subtitle1",children:"Delivery Address"}),e.jsxs(a,{children:[t.first_name," ",t.last_name," | ",t.phone_number]}),e.jsx(a,{children:t.shipping_address})]}),e.jsx(st,{sx:{my:2}}),e.jsxs(f,{sx:{mb:3},children:[e.jsxs(a,{variant:"subtitle1",sx:{mb:2},children:[e.jsx(Mt,{})," Shipping Method"]}),e.jsxs(Ft,{value:m,onChange:W,children:[e.jsx(ee,{variant:"outlined",sx:{mb:1,p:2},children:e.jsx(ve,{value:"Standard",control:e.jsx(Ce,{}),label:e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle2",children:"Standard Delivery"}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Estimated delivery: ",G("Standard")]}),e.jsx(a,{variant:"body2",color:"primary",children:H(Q.standard)})]}),disabled:t.status!==F.PENDING})}),e.jsx(ee,{variant:"outlined",sx:{p:2},children:e.jsx(ve,{value:"Express",control:e.jsx(Ce,{}),label:e.jsxs(f,{children:[e.jsx(a,{variant:"subtitle2",children:"Express Delivery"}),e.jsxs(a,{variant:"body2",color:"text.secondary",children:["Estimated delivery: ",G("Express")]}),e.jsx(a,{variant:"body2",color:"primary",children:H(Q.express)})]}),disabled:t.status!==F.PENDING})})]})]}),e.jsxs(f,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[e.jsx(a,{variant:"subtitle2",children:"Selected Shipping Option:"}),e.jsxs(a,{children:[m==="Standard"?"Standard Delivery":"Express Delivery"," - ",H(m==="Standard"?Q.standard:Q.express)]})]}),e.jsx(ke,{open:i,onClose:()=>h(!1),maxWidth:"md",fullWidth:!0,children:e.jsxs(f,{sx:{p:3},children:[e.jsx(a,{variant:"h6",sx:{mb:3},children:"Edit Shipping Address"}),e.jsxs(U,{container:!0,spacing:2,children:[e.jsx(U,{item:!0,xs:12,md:6,children:e.jsx(K,{fullWidth:!0,label:"First Name",value:R,onChange:o=>{w(o.target.value),r({first_name:o.target.value})},required:!0,error:!R,helperText:!R&&"First name is required",sx:{mb:2}})}),e.jsx(U,{item:!0,xs:12,md:6,children:e.jsx(K,{fullWidth:!0,label:"Last Name",value:E,onChange:o=>{O(o.target.value),r({last_name:o.target.value})},required:!0,error:!E,helperText:!E&&"Last name is required",sx:{mb:2}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(K,{fullWidth:!0,label:"Phone Number",value:P,onChange:o=>{B(o.target.value),r({phone_number:o.target.value})},inputProps:{minLength:5},error:!D.test(P),helperText:!D.test(P)&&"Phone number must be 10 digits long and contain only numbers",sx:{mb:2}})}),e.jsx(U,{item:!0,xs:12,md:4,children:e.jsxs(se,{fullWidth:!0,children:[e.jsx(oe,{children:"Province"}),e.jsx(ae,{value:c.province_code,onChange:z,label:"Province",children:j.map(o=>e.jsx(te,{value:o.code,children:o.name},o.code))})]})}),e.jsx(U,{item:!0,xs:12,md:4,children:e.jsxs(se,{fullWidth:!0,disabled:!c.province_code,children:[e.jsx(oe,{children:"District"}),e.jsx(ae,{value:c.district_code,onChange:k,label:"District",children:y.map(o=>e.jsx(te,{value:o.code,children:o.name},o.code))})]})}),e.jsx(U,{item:!0,xs:12,md:4,children:e.jsxs(se,{fullWidth:!0,disabled:!c.district_code,children:[e.jsx(oe,{children:"Ward"}),e.jsx(ae,{value:c.ward_code,onChange:u,label:"Ward",children:_.map(o=>e.jsx(te,{value:o.code,children:o.name},o.code))})]})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(K,{fullWidth:!0,label:"Street Address",value:c.street_address,onChange:o=>b({...c,street_address:o.target.value}),inputProps:{required:!0},error:!c.street_address,helperText:!c.street_address&&"Street address is required"})})]}),e.jsxs(f,{sx:{mt:3,display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(A,{onClick:()=>{h(!1),w(t.first_name),O(t.last_name),B(t.phone_number)},children:"Cancel"}),e.jsx(A,{variant:"contained",onClick:()=>{M(),r({first_name:R,last_name:E,phone_number:P,shipping_address:we(c),shipping_method:m})},disabled:!$(),children:"Save Changes"})]})]})})]})};L(A)(({theme:t})=>({color:t.palette.grey[800],borderColor:t.palette.grey[300],"&:hover":{borderColor:t.palette.grey[500]}}));const Gt=L(f)(({theme:t})=>({backgroundColor:t.palette.primary.main,color:"white",padding:t.spacing(2),borderRadius:t.shape.borderRadius,marginBottom:t.spacing(3)})),Y=L(ee)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(3),borderRadius:t.shape.borderRadius})),ce=L(f)(({theme:t})=>({borderBottom:`1px solid ${t.palette.divider}`,paddingBottom:t.spacing(2),marginBottom:t.spacing(2)})),$t=L(f)(({theme:t})=>({display:"flex",padding:t.spacing(2),borderBottom:`1px solid ${t.palette.divider}`,"&:last-child":{borderBottom:"none"}})),lr=()=>{const{orderId:t}=Le(),r=Be(),d=Ge(),[i,h]=l.useState([]),[j,v]=l.useState(!0),[y,C]=l.useState(null),[_,N]=l.useState(!1),[c,b]=l.useState(null),{user:m}=$e(),[n,P]=l.useState(null);it(d.breakpoints.down("sm"));const[B,R]=l.useState(!1),[w,E]=l.useState(""),[O,z]=l.useState(""),k=X()||"",[u,G]=l.useState({});l.useEffect(()=>{k&&t&&(v(!0),C(null),Promise.all([Qe(parseInt(t)),fe(parseInt(t))]).then(([s,x])=>{if(s)P(s);else throw new Error("Failed to fetch order");if(Array.isArray(x))h(x);else throw new Error("Invalid order details format")}).catch(s=>{console.error("Error fetching order data:",s),C(s.message||"Failed to fetch order data"),I.error("Failed to load order information")}).finally(()=>{v(!1)}))},[t,k,r]);const D=async()=>{if(n)try{const s={payment_amount:n.total_money,payment_method:n.payment_method,payment_type:"ORDER",order_id:n.id,user_id:(m==null?void 0:m.id)||0,bank_number:null,bank_name:null},x=await nt(s,Ye("access_token")||"");if(x)if(n.payment_method==="Cash")I.success("Cash payment recorded successfully");else if(x.paymentUrl)window.location.href=x.paymentUrl;else throw new Error("No payment URL received for online payment");else throw new Error("Failed to create payment")}catch(s){console.error("Error processing payment:",s),s instanceof Error?I.error(s.message):I.error("Failed to process payment. Please try again.")}},M=async s=>{if(n&&n.id)try{const x=await Ze(n.id,s,X()||"");P(x),I.success(`Order status updated to ${s} successfully`)}catch(x){console.error("Error updating order status:",x),I.error("Failed to update order status. Please try again.")}},$=(s,x)=>{E(s),z(x),R(!0)},W=()=>{R(!1)},o=async()=>{switch(R(!1),w){case"payment":await D();break;case"delivery":await M(F.DELIVERED);break;case"cancel":await M(F.CANCELLED);break;case"save":try{const s={...n,...u,total_money:T(n,u)};v(!0);const x=await Je(s,k);if(x){P(x),G({}),I.success("Order saved successfully");try{const V=await fe(x.id);Array.isArray(V)&&h(V)}catch(V){console.error("Error refreshing details:",V)}}else throw new Error("Failed to update order")}catch(s){console.error("Error saving order:",s),I.error(`Failed to save order changes, ${s.response.data.phoneNumber}.`),C("Failed to save order changes")}finally{v(!1)}break}},p=s=>{if(s.shipping_address===void 0||s.phone_number===void 0){I.error("Shipping address and phone number are required to save the order");return}G(x=>({...x,...s}))},g=async()=>{if(!(!k||!n))try{const s=T(n,u),x={...n,...u,total_money:s};G(x),$("save","Are you sure you want to save all changes to this order?")}catch(s){console.error("Error saving order:",s),I.error("Failed to save order changes")}},S=s=>{G(x=>{const V={...x,...s};if(s.shipping_method){const he=T(n,V);V.total_money=he}return V})},T=(s,x)=>(x.shipping_method||s.shipping_method)==="Express"?Q.express:Q.standard;return e.jsxs(ze,{maxWidth:"lg",sx:{py:4},children:[n&&e.jsx(Gt,{children:e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(a,{variant:"h6",children:["Order #",t]}),e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(a,{children:"Status:"}),e.jsx(a,{variant:"h6",sx:{fontWeight:"bold"},children:n.status})]})]})}),j&&e.jsx(Te,{}),y&&e.jsx(a,{color:"error",children:y}),n&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx(ce,{children:e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(a,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(Nt,{sx:{verticalAlign:"middle",mr:1}}),"Products"]}),rt.find(s=>s.id===i[0].product_id.owner_id)&&e.jsx(Ve,{to:`/breeder/${i[0].product_id.owner_id}/info`,style:{textDecoration:"none"},children:e.jsx(A,{variant:"outlined",startIcon:e.jsx(Ot,{}),size:"small",children:"Visit Store"})})]})}),i.map(s=>e.jsxs($t,{children:[e.jsx(f,{sx:{width:100,height:100,backgroundColor:"rgb(79 146 209)",borderRadius:1,mr:2,overflow:"hidden"},children:e.jsx("img",{src:s.product_id.thumbnail,alt:s.product_id.name,style:{width:"100%",height:"100%",objectFit:"contain"}})}),e.jsxs(f,{flex:1,children:[e.jsx(a,{variant:"subtitle1",fontWeight:"bold",children:s.product_id.name}),e.jsxs(a,{color:"text.secondary",gutterBottom:!0,children:["Quantity: ",i.length]}),e.jsx(a,{color:"primary",fontWeight:"bold",children:H(s.total_money)})]})]},s.id)),e.jsxs(f,{sx:{mt:2,p:2,backgroundColor:"#f5f5f5",borderRadius:1},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(a,{color:"text.secondary",children:"Subtotal (Already Paid):"}),e.jsx(a,{color:"text.secondary",sx:{textDecoration:"line-through",opacity:.7},children:H(i.reduce((s,x)=>s+x.total_money,0))})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(a,{children:"Shipping Fee:"}),e.jsx(a,{children:H(T(n,u))})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",children:[e.jsx(a,{variant:"h6",children:"Total to Pay:"}),e.jsx(a,{variant:"h6",color:"primary.main",children:H(T(n,u))})]})]})]}),e.jsx(Y,{children:n&&e.jsx(Bt,{order:{...n,...u},onTempUpdate:S,onSave:p})}),e.jsxs(Y,{children:[e.jsx(ce,{children:e.jsxs(a,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(Re,{sx:{verticalAlign:"middle",mr:1}}),"Order Notes"]})}),e.jsx(K,{fullWidth:!0,multiline:!0,rows:4,label:"Notes for your order",value:u.note||n.note||"",onChange:s=>S({note:s.target.value}),placeholder:"Add any special instructions or notes for your order here...",sx:{mt:2},disabled:n.status!==F.PENDING})]}),Object.keys(u).length>0&&e.jsxs(Y,{children:[e.jsx(a,{variant:"h6",sx:{mb:2},children:"Pending Changes"}),u.shipping_method&&e.jsxs(a,{children:["Shipping Method:"," ",u.shipping_method==="Standard"?"Standard":"Express"," ","Delivery"]}),u.phone_number&&e.jsxs(a,{children:["Phone Number: ",u.phone_number]}),u.note&&e.jsxs(a,{children:["Note: ",u.note]})]}),e.jsxs(Y,{children:[e.jsx(ce,{children:e.jsxs(a,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(Se,{sx:{verticalAlign:"middle",mr:1}}),"Payment Information"]})}),e.jsxs(se,{fullWidth:!0,sx:{mt:2},children:[e.jsx(oe,{id:"payment-method-label",children:"Payment Method"}),e.jsxs(ae,{labelId:"payment-method-label",id:"payment-method",value:u.payment_method||n.payment_method,label:"Payment Method",onChange:s=>S({payment_method:s.target.value}),disabled:n.status!==F.PENDING,children:[e.jsx(te,{value:"Cash",children:"Cash"}),e.jsx(te,{value:"Payment",children:"Online Payment"})]})]}),e.jsx(a,{sx:{mt:2,color:"text.secondary",fontSize:"0.875rem"},children:u.payment_method==="Payment"||n.payment_method==="Payment"&&!u.payment_method?"You will be redirected to payment gateway after confirming":"You will pay in cash upon delivery"})]}),e.jsxs(f,{display:"flex",gap:2,justifyContent:"flex-end",mt:3,children:[Object.keys(u).length>0&&e.jsx(A,{variant:"contained",color:"success",startIcon:e.jsx(Dt,{}),onClick:g,children:"Save Order"}),n.status===F.PENDING&&Object.keys(u).length===0&&e.jsx(A,{variant:"contained",color:"primary",startIcon:e.jsx(Se,{}),onClick:()=>$("payment","Are you sure you want to process the payment for this order?"),children:"Process Payment"}),n&&(n.status===F.PENDING||n.status===F.PROCESSING)&&e.jsx(A,{variant:"contained",color:"warning",onClick:()=>$("cancel","Are you sure you want to cancel this order?"),children:"Cancel Order"}),n&&n.status===F.SHIPPING&&e.jsx(A,{variant:"contained",color:"secondary",onClick:()=>$("delivery","Are you sure you want to mark this order as delivered?"),children:"MARK AS DELIVERED"})]})]}),n&&n.status!==F.PENDING&&e.jsx(Y,{sx:{mt:3},children:e.jsx(It,{orderId:t||""})}),e.jsxs(ke,{open:B,onClose:W,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(We,{id:"alert-dialog-title",children:"Confirm Action"}),e.jsx(Ue,{children:e.jsx(at,{id:"alert-dialog-description",children:O})}),e.jsxs(qe,{children:[e.jsx(A,{onClick:W,children:"Cancel"}),e.jsx(A,{onClick:o,autoFocus:!0,children:"Confirm"})]})]}),Object.keys(u).length>0&&e.jsx(ee,{sx:{position:"fixed",bottom:16,right:16,p:2,backgroundColor:d.palette.grey[200],zIndex:1e3,border:"1px solid",borderColor:d.palette.grey[300],borderRadius:d.shape.borderRadius},children:e.jsx(a,{variant:"body2",color:"black",children:"You have unsaved changes"})}),e.jsx(He,{})]})};export{lr as default};
