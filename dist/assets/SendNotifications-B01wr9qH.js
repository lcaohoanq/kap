import{g as u,k as e,T as f,ap as j,B as g,C as p,Q as O,x as l,t as y,D as C,ai as S}from"./index-CvZ0wdb0.js";import{B as W}from"./Box-CMC4TlbO.js";import{T}from"./TextField-DmIMr6K4.js";import{F as P,I as $,S as L}from"./Select-D5OM6xxo.js";import{M as h}from"./MenuItem-4CYdLiSI.js";import"./useFormControl-Cz7kLNRm.js";import"./dividerClasses-D9IiBztf.js";const z=60,w={title:"",message:"",recipientType:"all"},G=()=>{const[n,d]=u.useState(w),[s,m]=u.useState({form:!1,upcomingNotification:!1,closingNotification:!1}),[c,x]=u.useState({}),[t,b]=u.useState(0);u.useEffect(()=>{let i;return t>0&&(i=setInterval(()=>{b(o=>o-1)},1e3)),()=>{i&&clearInterval(i)}},[t]);const I=()=>{const i={};return n.title.trim()||(i.title="Title is required"),n.message.trim()||(i.message="Message is required"),n.message.length>500&&(i.message="Message must be less than 500 characters"),x(i),Object.keys(i).length===0},N=i=>{const{name:o,value:r}=i.target;d(a=>({...a,[o]:r})),c[o]&&x(a=>({...a,[o]:void 0}))},k=i=>{d(o=>({...o,recipientType:i.target.value}))},B=async i=>{var o,r;if(i.preventDefault(),!I()){l.error("Please fix the errors in the form");return}m(a=>({...a,form:!0}));try{await y.post(`${C}/notifications`,n,{headers:{Authorization:`Bearer ${S()}`}}),l.success("Notification sent successfully"),d(w)}catch(a){const F=((r=(o=a.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to send notification";l.error(F)}finally{m(a=>({...a,form:!1}))}},E=async()=>{var i,o;if(t>0){l.warning(`Please wait ${t} seconds before sending again`);return}m(r=>({...r,upcomingNotification:!0}));try{await y.get(`${C}/auctions/notify/upcoming`,{headers:{Authorization:`Bearer ${S()}`}}),l.success("Upcoming auction notifications sent successfully"),b(z)}catch(r){const v=((o=(i=r.response)==null?void 0:i.data)==null?void 0:o.message)||"Failed to send upcoming auction notifications";l.error(v)}finally{m(r=>({...r,upcomingNotification:!1}))}},M=async()=>{},U=()=>s.upcomingNotification?"Sending...":t>0?`Wait ${t}s`:"Send Upcoming Auction Notifications",A=()=>s.closingNotification?"Sending...":t>0?`Wait ${t}s`:"Send Closing Auction Notifications";return e.jsxs(W,{className:"m-5 mx-auto max-w-2xl",children:[e.jsx(f,{variant:"h4",component:"h1",className:"mb-6 text-center font-bold",children:"Send Notifications"}),e.jsxs(j,{elevation:3,className:"mt-6 p-6 mb-5 flex flex-col gap-3",children:[e.jsx(f,{variant:"h6",className:"mb-4",children:"Quick Actions"}),e.jsx(g,{variant:"contained",color:"warning",fullWidth:!0,onClick:E,disabled:s.upcomingNotification||t>0,startIcon:s.upcomingNotification&&e.jsx(p,{size:20,color:"inherit"}),sx:{"&.Mui-disabled":{backgroundColor:t>0?"rgba(245, 124, 0, 0.5)":void 0,color:t>0?"white":void 0}},children:U()}),e.jsx(g,{variant:"contained",color:"warning",fullWidth:!0,onClick:M,disabled:s.closingNotification||t>0,startIcon:s.closingNotification&&e.jsx(p,{size:20,color:"inherit"}),sx:{"&.Mui-disabled":{backgroundColor:t>0?"rgba(245, 124, 0, 0.5)":void 0,color:t>0?"white":void 0}},children:A()})]}),e.jsxs(j,{elevation:3,className:"p-6 mb-5",children:[e.jsx(f,{variant:"h6",className:"mb-4",children:"Send Email"}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsx(T,{fullWidth:!0,margin:"normal",name:"title",label:"Notification Title",value:n.title,onChange:N,error:!!c.title,helperText:c.title,disabled:s.form,sx:{bgcolor:"background.paper"}}),e.jsx(T,{fullWidth:!0,margin:"normal",name:"message",label:"Notification Message",multiline:!0,rows:10,value:n.message,onChange:N,error:!!c.message,helperText:c.message,disabled:s.form,sx:{bgcolor:"background.paper"}}),e.jsxs(P,{fullWidth:!0,margin:"normal",children:[e.jsx($,{id:"recipient-type-label",children:"Recipient Type"}),e.jsxs(L,{labelId:"recipient-type-label",value:n.recipientType,onChange:k,disabled:s.form,children:[e.jsx(h,{value:"all",children:"All Users"}),e.jsx(h,{value:"premium",children:"Premium Users"}),e.jsx(h,{value:"free",children:"Free Users"})]})]}),e.jsx(g,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:s.form,startIcon:s.form&&e.jsx(p,{size:20,color:"inherit"}),children:s.form?"Sending...":"Send Notification"})]})]}),e.jsx(O,{position:"top-right",autoClose:5e3,hideProgressBar:!1,newestOnTop:!0,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})};export{G as default};
