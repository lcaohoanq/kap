import{k as e,T as m,S as _,l as $,aa as F,am as L,g as a,o as M,j as U,a0 as A,a1 as E,L as H,x as u}from"./index-AR-vc5G8.js";import{S as V}from"./index-Dh4_gD2h.js";import{d as O}from"./useSearch-Cab68gn1.js";import{P as z}from"./PaginationComponent-uQg9GVCj.js";import{K as q}from"./KoiSearchGrid-D9FA2PJ7.js";import{S as G}from"./SearchBar-UzJbn6Ei.js";import{B as J}from"./Box-BNjxVqqI.js";import{C as y}from"./CrudButtonComponent-D_ki3HyG.js";import{e as R}from"./dataConverter-DUStkNR_.js";import"./Select-DxrLQvkV.js";import"./useFormControl-SUgb0ygc.js";import"./useBreeders-C3BZ4vL6.js";import"./KoiDetails-bNB2c2Qv.js";import"./TextField-B9Z4Mbip.js";import"./dateTimeUtils-BcV6LRrk.js";import"./format-BOZTN9QO.js";const Q=({onSearchStateChange:g,handleEdit:s,handleDelete:p,renderActions:c})=>{const{query:f,setQuery:x,results:o,loading:l,error:j,page:v,totalPages:h,totalItems:S,handlePageChange:i}=O(500);return e.jsxs("div",{className:"container mx-auto p-4 mt-10",children:[e.jsxs("div",{className:"bg-gray-200 p-4 rounded-xl",children:[e.jsx(m,{variant:"h6",sx:{textAlign:"left",marginBottom:"1rem"},children:_.SEARCH_UNVERIFIED_KOI}),e.jsx(G,{value:f,onChange:x,loading:l,placeholder:_.EXAMPLE_KOI_SEARCH}),e.jsx(m,{variant:"body2",sx:{textAlign:"left",marginTop:"1rem"},color:"error",children:$.SEARCH_ALL_KOI_DESCRIPTION})]}),l&&e.jsx(J,{display:"flex",justifyContent:"center",my:4,children:e.jsx(F,{})}),j&&e.jsx("p",{className:"text-red-500 mt-2",children:j.message}),o.length>0&&!l&&e.jsxs("div",{className:"mt-3 text-gray-500",children:[e.jsxs(m,{variant:"body2",className:"mt-3",children:["Showing 1 - ",o.length," of ",S," results."]}),e.jsx(q,{kois:o,getLinkUrl:d=>`/kois/${d.id}`,handleEdit:s,handleDelete:p,renderActions:c}),e.jsx(z,{totalPages:h,currentPage:v,onPageChange:i})]}),!l&&f&&o.length===0&&e.jsx("p",{className:"mt-2",children:"No results found."})]})},me=()=>{const g=L("user_id"),s=L("access_token"),[p,c]=a.useState([]),[f,x]=a.useState(0),[o,l]=a.useState(1),[j,v]=a.useState(!0),h=8,[S,i]=a.useState(!0),[d,P]=a.useState(null),{isLoggedIn:I}=M(),w=U(),[W,B]=a.useState(!1),b=t=>{B(t)},D=t=>{w(`/kois/${t}`)},K=async t=>{i(!0);try{await A.put(`${E}/kois/status/${t}`,{tracking_status:"VERIFIED"},{headers:{Authorization:`Bearer ${s}`}}),u.success("Koi Approved successfully"),c(r=>r.filter(n=>n.id!==t))}catch(r){const n=R(r,"Failed to approve Koi");u.error(n)}finally{i(!1)}},k=async t=>{if(confirm("Are you sure you want to reject this koi?"))try{await A.put(`${E}/kois/status/${t}`,{tracking_status:"REJECTED"},{headers:{Authorization:`Bearer ${s}`}}),u.success("Koi rejected"),c(n=>n.filter(C=>C.id!==t))}catch(n){const C=R(n,"Failed to reject Koi");u.error(C)}},N=a.useCallback(async()=>{if(!s){P("No access token available"),i(!1);return}try{i(!0);const r=(await A.get(`${E}/kois/status`,{params:{status:"UNVERIFIED",page:o-1,limit:h},headers:{Authorization:`Bearer ${s}`}})).data;r&&(c(r.item),x(r.total_item),v(r.total_page>o))}catch(t){console.error("Cannot fetch Koi data:",t),P("Failed to fetch Koi data")}finally{i(!1)}},[s,o,h]);if(a.useEffect(()=>{I&&g&&s&&N()},[I,g,s,N]),S)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(H,{})});if(d)return e.jsxs("div",{children:["Error: ",d]});const T=t=>e.jsxs(e.Fragment,{children:[e.jsx(y,{onClick:()=>D(t.id),ariaLabel:"View",svgPath:"view.svg",width:30,height:30}),e.jsx(y,{onClick:()=>K(t.id),ariaLabel:"Approve",svgPath:"approve.svg",width:30,height:30}),e.jsx(y,{onClick:()=>k(t.id),ariaLabel:"No Approve",svgPath:"notapprove.svg",width:30,height:30})]});return e.jsxs("div",{children:[p.length>0?e.jsx(Q,{onSearchStateChange:b,handleEdit:K,handleDelete:k,renderActions:T}):e.jsx("div",{className:"flex flex-col justify-center items-center h-[30rem]",children:e.jsx(m,{variant:"h3",sx:{color:"error.main",fontWeight:"bold",textAlign:"center"},children:"Koi's Unverified Not Available"})}),e.jsx(V,{smooth:!0})]})};export{me as default};
