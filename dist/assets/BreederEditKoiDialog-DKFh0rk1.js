import{g as d,q as Y,z as p,l as r,L as w,av as C,ax as M,ay as O,B as f,aw as P,aV as x,Q,am as V}from"./index-CZBwRkMB.js";import{a as q,u as z}from"./koi.apis-B84lydGY.js";import{k as X}from"./regex-DBRfaSZx.js";import{S as y,K as l}from"./validation.message-sNiVE3QT.js";import{e as Z,b as J}from"./dataConverter-Dy8MubmD.js";import{B as m}from"./Box-C_9pThu7.js";import{T as _}from"./TextField-CYZD3Swe.js";import{F as b,I as D,S as j}from"./Select-Brq7J5Hy.js";import{M as i}from"./MenuItem-DxENn0FA.js";import{S as $}from"./Snackbar-DvFOCUZb.js";const de=({open:h,onClose:c,koiId:g})=>{const[e,S]=d.useState(),[L,R]=d.useState(!0),[I,T]=d.useState(null),[U,E]=d.useState(!1),[B,A]=d.useState(""),[t,F]=d.useState({}),K=Y();d.useEffect(()=>{h&&N()},[h,g]);const v=()=>{const a=V("access_token");return a||(K("/notfound"),null)},N=async()=>{if(R(!0),!!v())try{const s=await q(g);S(s)}catch(s){const n=Z(s,"Failed to fetch koi data");p.error(n),T(n)}finally{R(!1)}},o=a=>{const{name:s,value:n}=a.target;["length","category_id","year_born"].includes(s)&&Number(n)<0||S(u=>u?{...u,[s]:n}:void 0)},G=()=>{const a={};return[{field:"name",validate:()=>!X.test((e==null?void 0:e.name)||""),errorMessage:l.KOI_NAME_MUST_FOLLOWING_FORMAT},{field:"sex",validate:()=>!(e!=null&&e.sex),errorMessage:l.GENDER_IS_REQUIRED},{field:"length",validate:()=>!(e!=null&&e.length),errorMessage:l.LENGTH_IS_REQUIRED},{field:"year_born",validate:()=>!(e!=null&&e.year_born),errorMessage:l.YEAR_BORN_IS_REQUIRED},{field:"thumbnail",validate:()=>!(e!=null&&e.thumbnail),errorMessage:l.THUMBNAIL_URL_IS_REQUIRED},{field:"is_display",validate:()=>!(e!=null&&e.is_display),errorMessage:l.IS_DISPLAY_IS_REQUIRED}].forEach(({field:n,validate:u,errorMessage:H})=>{u()&&(a[n]=H)}),e&&((e.length<=0||e.length>=125)&&(a.length=l.LENGTH_MUST_BE_GREATER_THAN_ZERO_AND_LESS_THAN_125),e.year_born<0&&(a.year_born=l.YEAR_BORN_CANNOT_BE_NEGATIVE),e.year_born>new Date().getFullYear()&&(a.year_born=l.YEAR_BORN_CANNOT_BE_IN_FUTURE),e.category_id<=0&&(a.category_id=l.CATEGORY_IS_REQUIRED)),F(a),Object.keys(a).length===0},W=async()=>{if(!e)return;if(!G()){A(y.PLEASE_FIX_THE_ERRORS_IN_THE_FORM),E(!0);return}if(v())try{await z(g,e),A(y.KOI_UPDATE_SUCCESS),p.success(y.KOI_UPDATE_SUCCESS),E(!0),c(),N()}catch(s){const n=s instanceof Error?s.message:"An unexpected error occurred";p.error(n),T(n)}};return L?r.jsx(w,{}):I?r.jsxs(C,{open:h,onClose:c,children:[r.jsx(M,{children:r.jsx(m,{sx:{color:"error.main"},children:I})}),r.jsx(O,{children:r.jsx(f,{onClick:c,children:"Close"})})]}):r.jsxs(r.Fragment,{children:[r.jsxs(C,{open:h,onClose:c,maxWidth:"lg",fullWidth:!0,children:[r.jsx(P,{fontSize:20,sx:{textAlign:"center"},children:"Edit Koi"}),r.jsx(M,{children:r.jsxs(m,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[r.jsxs(m,{sx:{display:"flex",gap:2},children:[r.jsx(_,{name:"name",label:"Name",type:"text",fullWidth:!0,variant:"outlined",value:(e==null?void 0:e.name)??"",onChange:o,error:!!t.name,helperText:t.name}),r.jsxs(b,{fullWidth:!0,variant:"outlined",children:[r.jsx(D,{id:"gender-label",children:"Gender"}),r.jsxs(j,{labelId:"gender-label",name:"sex",label:"Gender",value:(e==null?void 0:e.sex)??"",onChange:o,children:[r.jsx(i,{value:"",disabled:!0,children:"Select Gender"}),r.jsx(i,{value:"MALE",children:"Male"}),r.jsx(i,{value:"FEMALE",children:"Female"}),r.jsx(i,{value:"UNKNOWN",children:"Unknown"})]}),t.gender&&r.jsx("p",{style:{color:"red"},children:t.gender})]})]}),r.jsxs(b,{fullWidth:!0,margin:"none",children:[r.jsxs(j,{name:"category_id",value:(e==null?void 0:e.category_id)??"",onChange:o,displayEmpty:!0,children:[r.jsx(i,{value:"",disabled:!0,children:"Select Category"}),Object.entries(J).map(([a,s])=>r.jsx(i,{value:Number(a),children:s},a))]}),t.category_id&&r.jsx("p",{style:{color:"red"},children:t.category_id})]}),r.jsxs(m,{sx:{display:"flex",gap:2},children:[r.jsx(_,{name:"length",label:x.LENGTH,type:"number",fullWidth:!0,variant:"outlined",value:(e==null?void 0:e.length)??"",inputProps:{min:0},onChange:o,error:!!t.length,helperText:t.length}),r.jsx(_,{name:"year_born",label:x.YEAR_BORN,type:"number",fullWidth:!0,variant:"outlined",value:(e==null?void 0:e.year_born)??"",inputProps:{min:1e3,max:new Date().getFullYear()},onChange:o,error:!!t.year_born,helperText:t.year_born})]}),r.jsx(_,{name:"thumbnail",label:x.THUMBNAIL_URL,type:"text",fullWidth:!0,variant:"outlined",value:(e==null?void 0:e.thumbnail)??"",onChange:o,error:!!t.thumbnail,helperText:t.thumbnail}),r.jsx(_,{fullWidth:!0,name:"description",label:x.DESCRIPTION,type:"text",variant:"outlined",multiline:!0,rows:3,value:(e==null?void 0:e.description)??"",onChange:o}),r.jsxs(b,{fullWidth:!0,variant:"outlined",children:[r.jsx(D,{id:"is_display-label",children:"Is Display"}),r.jsxs(j,{labelId:"is_display-label",name:"is_display",type:"number",label:"Is display (1/0)",value:(e==null?void 0:e.is_display)??"",onChange:o,children:[r.jsx(i,{value:"",disabled:!0,children:"Select Is Display"}),r.jsx(i,{value:"1",children:"Yes"}),r.jsx(i,{value:"0",children:"No"})]}),t.is_display&&r.jsx("p",{style:{color:"red"},children:t.is_display})]})]})}),r.jsxs(O,{children:[r.jsx(f,{onClick:c,children:"Cancel"}),r.jsx(f,{onClick:W,variant:"contained",color:"primary",children:"Update"})]})]}),r.jsx($,{open:U,autoHideDuration:6e3,onClose:()=>E(!1),message:B}),r.jsx(Q,{})]})};export{de as B};
