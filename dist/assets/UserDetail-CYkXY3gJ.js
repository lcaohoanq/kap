import{a0 as _,a1 as w,ac as $,$ as O,ab as L,g as a,j as V,k as e,L as q,ae as C,T as W,a4 as v,al as z,am as f,an as E,B as A,Q as G,x as p}from"./index-AR-vc5G8.js";import{a as K}from"./otp.apis-DeJFZJ_K.js";import{A as Q}from"./AccountTransactionComponent-CsTjaRR4.js";import{A as X,U as Y}from"./UserDetailDialog-Nm06x_jX.js";import{f as H}from"./currencyUtils-DiCxv8hG.js";import{e as J}from"./dataConverter-DUStkNR_.js";import{f as Z}from"./dateTimeUtils-BcV6LRrk.js";import{D as R}from"./Divider-CO8vTR6a.js";import{F as ee,I as se,S as te}from"./Select-DxrLQvkV.js";import{M as S}from"./MenuItem-B-jXWqVy.js";import{T as re}from"./TextField-B9Z4Mbip.js";import"./payment.apis-B1GwTejV.js";import"./Alert-COHT3LuI.js";import"./Chip-ByiOsKko.js";import"./Box-BNjxVqqI.js";import"./regex-DBRfaSZx.js";import"./format-BOZTN9QO.js";import"./dividerClasses-XtBg11Mw.js";import"./useFormControl-SUgb0ygc.js";const ae=async(s,u)=>{var m,o;try{return(await _.post(`${w}/mail/update-role?updateRole=${s}`,{purpose:u},{headers:{Authorization:`Bearer ${$()}`}})).data}catch(n){if(_.isAxiosError(n)){const c=((o=(m=n.response)==null?void 0:m.data)==null?void 0:o.reason)||"An error occurred during send email update role";throw new Error(c)}else throw new Error(O.UNEXPECTED_ERROR)}},Se=()=>{const{data:s,isLoading:u,error:m}=L(),[o,n]=a.useState(!1),[c,j]=a.useState(!1),[N,g]=a.useState(),d=V(),[h,y]=a.useState(!0),[b,x]=a.useState({type:null,loading:!1}),r=()=>y(!h);if(u)return e.jsx(q,{});if(m)return e.jsx("div",{children:"Error "});if(!s)return e.jsx("div",{children:"No user data found"});s.role_name!==C.MEMBER&&d("/notfound");const k=async()=>{const t=f("user_id"),l=f("access_token");if(!t||!l){d("/notfound");return}x({type:"update",loading:!0});try{const i=await _.get(`${w}/users/${t}`,{headers:{Authorization:`Bearer ${l}`}});g(i.data),j(!0)}catch(i){console.error("Failed to fetch user data",i),p.error("Failed to fetch user data")}finally{x({type:null,loading:!1})}},M=()=>{j(!1)},F=async()=>{if(s){x({type:"verify",loading:!0});try{(await K(s.email)).status===200?d("/otp-verification",{state:{email:s.email,from:"userDetail",statusCode:200}}):p.error("Failed to send OTP")}catch{p.error("An error occurred while sending OTP")}finally{x({type:null,loading:!1})}}},I=()=>{n(!0)},D=()=>{n(!1)},T=async(t,l)=>{if(s)try{await ae(t,l),p.success("Send Update Role Email Successfully")}catch(i){const P=J(i,"Error send email update role");p.error(P)}},U=async()=>{try{const t=f("user_id"),l=f("access_token");if(!t||!l){d("/notfound");return}}catch(t){console.error("Failed to refresh user data",t)}},B=(t,l)=>{const i=b.type===t&&b.loading;return e.jsx("button",{onClick:F,disabled:i,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition",children:i?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-5 h-5 border-t-2 border-b-2 border-current rounded-full animate-spin mr-2"}),"Loading..."]}):l})};return e.jsxs("div",{className:"container mx-auto mt-12 mb-36",children:[e.jsx(X,{user:s}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg flex flex-col justify-around mr-10 p-6",children:[e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:s.avatar_url,alt:`${s.first_name} ${s.last_name}`,className:"mb-4 w-[15rem] rounded-full"})}),s.status_name!=="VERIFIED"&&B("verify",e.jsxs(e.Fragment,{children:[e.jsx(v,{icon:E,className:"mr-2"}),"Verify Account"]}))]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("h2",{className:"text-2xl text-black",children:"Account Details"}),e.jsx(R,{"aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Email"}),e.jsx("p",{children:s.email})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Phone Number"}),e.jsx("p",{children:s.phone_number||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Address"}),e.jsx("p",{children:s.address||"Not provided"})]}),e.jsx(R,{"aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Status"}),e.jsx("p",{children:s.status_name})]})]})]}),e.jsxs("div",{className:" md:col-span-2 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(W,{variant:"h4",children:[s.first_name," ",s.last_name]}),s.status_name==="VERIFIED"&&e.jsx(v,{icon:z,onClick:k,className:"text-2xl text-gray-400 hover:cursor-pointer"})]}),e.jsx("h2",{className:"text-2xl text-blue-500 mt-5 mb-6",children:s.role_name.charAt(0).toUpperCase()+s.role_name.slice(1)}),s.status_name=="VERIFIED"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center items-center gap-5",children:[e.jsx("p",{className:"text-xl font-bold mb-5",children:"Account Balance:"}),e.jsx("p",{className:"text-3xl text-green-600 font-bold mb-5",children:s.account_balance!==null?H(s.account_balance):"No money"})]}),e.jsx(Q,{userId:s.id,token:f("access_token")||"",onTransactionSuccess:U})]}),e.jsxs("div",{className:"text-left",children:[e.jsx(v,{icon:E,className:"mr-2"}),e.jsx(A,{onClick:r,variant:"text",color:"inherit",children:"About Me"}),e.jsx(R,{variant:"fullWidth"})]}),h&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-5 justify-between ",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Date of Birth"}),e.jsx("p",{children:s.date_of_birth||"Not Provided"})]}),e.jsxs("div",{className:"flex gap-5 justify-between ",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Created At"}),e.jsx("p",{children:Z(s.created_at||"")})]}),e.jsxs("div",{children:[s.status_name==="VERIFIED"&&s.role_name===C.MEMBER&&e.jsxs("button",{onClick:I,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-500 transition",children:[e.jsx(v,{icon:E,className:"mr-2"}),"I want to Update My Role"]}),e.jsx(oe,{isOpen:o,onClose:D,onSubmit:T})]})]})]})]}),e.jsx(Y,{openModal:c,handleClose:M}),e.jsx(G,{})]})},oe=({isOpen:s,onClose:u,onSubmit:m})=>{const[o,n]=a.useState(""),[c,j]=a.useState(""),[N,g]=a.useState(!1),[d,h]=a.useState(!1),y=r=>{n(r.target.value),g(!1)},b=r=>{j(r.target.value),h(!1)},x=()=>{let r=!0;o||(g(!0),r=!1),c||(h(!0),r=!1),r&&(m(o,c),u())};return e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center ${s?"":"hidden"}`,children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg w-1/3",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Select Role to Update"}),e.jsxs(ee,{fullWidth:!0,variant:"standard",error:N,className:"mb-4",children:[e.jsx(se,{children:"Select Role"}),e.jsxs(te,{value:o,onChange:y,label:"Choose a role",required:!0,className:"mb-4",children:[e.jsx(S,{value:"",children:e.jsx("em",{children:"Select Role"})}),e.jsx(S,{value:"BREEDER",children:"Breeder"}),e.jsx(S,{value:"STAFF",children:"Staff"})]}),N&&e.jsx("p",{className:"text-red-500 text-sm",children:"Role is required"})]}),e.jsx(re,{label:"Purpose",variant:"standard",required:!0,fullWidth:!0,value:c,onChange:b,error:d,helperText:d?"Purpose is required":"",className:"mb-4"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(A,{variant:"contained",color:"primary",onClick:x,className:"mr-2",children:"Submit"}),e.jsx(A,{variant:"contained",color:"error",onClick:u,children:"Cancel"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mt-3",children:"*Note: Please provide a valid reason for updating your role. We will review your request and get back to you as soon as possible."}),e.jsx("p",{className:"text-gray-400 mt-3",children:"Thanks for your patience. From Koi Auction Team."})]})]})})};export{Se as default};
