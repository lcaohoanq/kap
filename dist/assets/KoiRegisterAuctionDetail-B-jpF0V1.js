import{k as e,ao as ne,ap as oe,T as P,g as s,aO as ce,as as le,B as Y,j as re,ai as de,aB as ae,aE as J,a4 as ie,Q as ue,a2 as X,x as O,a0 as me,o as xe,a5 as pe}from"./index-DnNoBgXv.js";import{K as he}from"./KoiInAuctionGrid-DGrxD8aZ.js";import{b as fe}from"./colorUtils-fSs7u7YC.js";import{g as be}from"./dateTimeUtils-CQFQMvEL.js";import{C as Z}from"./CrudButtonComponent-zK_IvvHq.js";import{T as ge,B as Ne}from"./tableHeader-DHjbgUT0.js";import{g as je,e as ee}from"./dataConverter-BrNZpu9w.js";import{P as ye}from"./PaginationComponent-BvkYkrkj.js";import{H as Ee}from"./HelpOutline-CaAX4jLJ.js";import{C as Se}from"./ClickAwayListener-BEWAacWo.js";import{f as S}from"./currencyUtils-DiCxv8hG.js";import{B as te}from"./Box-93Gr-_1_.js";import{T as L,F as V}from"./TextField-D3d8CF4T.js";import{M as H}from"./MenuItem-BoEOSkex.js";import{f as se}from"./breeder.apis-CgFWxoj5.js";import{p as ve,a as we}from"./auctionkoi.apis-DpQJyX4n.js";import{A as Pe}from"./Alert-BN2ffhqu.js";import{a as Ce}from"./auction.apis-DFZyfirU.js";import{f as Ie}from"./koi.apis-Bggz8mQf.js";import"./KoiDetails-zTLh4etQ.js";import"./orders.type-CY8k0T_M.js";import"./format-BOZTN9QO.js";import"./Select-CUVNMReu.js";import"./useFormControl-CfpcpuJc.js";import"./dividerClasses-BYrq8pJy.js";const De=({open:o,onClose:y,anchorEl:p})=>e.jsx(ne,{open:o,anchorEl:p,placement:"right-start",style:{zIndex:1500,width:"500px"},children:e.jsx(Se,{onClickAway:y,children:e.jsxs(oe,{className:"p-6 bg-white rounded-lg shadow-md",sx:{width:"100%",position:"relative",outline:"none",marginTop:"8px"},children:[e.jsx(P,{variant:"h6",className:"mb-4 font-bold text-gray-800",children:"Registration Rules"}),e.jsx("p",{className:"mb-2 font-bold text-gray-600",children:"- Base price must be greater than or equal to Koi's original base price"}),e.jsx("p",{className:"mb-2 font-bold text-gray-600",children:"- Base price must not be greater than 50.000.000 VND"}),e.jsx("hr",{className:"my-2"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-600",children:[e.jsx("li",{className:"font-bold",children:"For Ascending Bid & Descending Bid Methods:"}),e.jsx("p",{children:"- Bid step must be at least 50.000 VND."}),e.jsx("p",{children:"- Ceiling price is required & greater than base price + 10 times of bid step."})]}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-600 mt-4",children:[e.jsx("li",{className:"font-bold",children:"For Fixed Price Bid Method:"}),e.jsx("p",{children:"- Bid step and ceiling price not required."})]}),e.jsx("hr",{className:"my-4"}),e.jsx(P,{variant:"body2",className:"mt-2 text-green-600",children:"Note: We will charge 10% of the base price as a service fee, please check this info clearly before submitting your auction. You cannot undo after submitting."})]})})}),G=5e4,$=5e7,U={pattern:"\\d*",onKeyDown:o=>{o.ctrlKey&&o.key==="a"||!/[0-9]/.test(o.key)&&o.key!=="Backspace"&&o.key!=="ArrowLeft"&&o.key!=="ArrowRight"&&o.preventDefault()}},Ae=({open:o,onClose:y,koiId:p,auctionId:c,basePrice:d,onSubmit:C})=>{const[l,A]=s.useState(""),[a,_]=s.useState(""),[i,R]=s.useState("ASCENDING_BID"),[E,k]=s.useState(""),[h,u]=s.useState(""),[n,m]=s.useState(""),[v,I]=s.useState(""),[B,f]=s.useState(""),[b,g]=s.useState(!1),[M,K]=s.useState(null),T=(t,N)=>{const x=t.target.value,j=q=>{const D=q===""?0:Number(q);if(D<0)return I("Ceil Price must be greater than 0."),!1;switch(N){case"basePrice":return D<d?(m(`Price must be greater than or equal to the original price of ${S(d)}.`),!1):D>$?(m(`Price cannot exceed ${S($)}.`),!1):(m(""),!0);case"bidStep":return i!=="FIXED_PRICE"&&D<G?(u(`Bid step must be at least ${S(G)}.`),!1):(u(""),!0);case"ceilPrice":if(i==="FIXED_PRICE")return I(""),!0;const z=a===""?0:Number(a),Q=l===""?0:Number(l);return D>0&&D<z+10*Q?(I(`Ceiling price must be greater than ${S(z+10*Q)} (base price + 10 times of bid step).`),!1):(i==="ASCENDING_BID"||i==="DESCENDING_BID")&&D===0?(I(`Ceiling price is required for ${i} bid method.`),!1):(I(""),!0);default:return!0}};switch(N){case"basePrice":_(x),j(x);break;case"bidStep":A(x),j(x);break;case"ceilPrice":k(x),j(x);break}};s.useEffect(()=>{const t=l===""?0:Number(l),N=a===""?0:Number(a);i!=="FIXED_PRICE"&&t<G?u(`Bid step must be at least ${S(G)}.`):t>=N?u("Bid step must be less than base price."):u("")},[l,i]),s.useEffect(()=>{const t=a===""?0:Number(a);t<d?m(`Price must be greater than or equal to the original price of ${S(d)}.`):t>$?m(`Price cannot exceed ${S($)}.`):m("")},[a,d]),s.useEffect(()=>{const t=a===""?0:Number(a);if(!n&&t>=d){const N=Math.floor(t*.1);f(`*We will charge 10% of the base price (${S(N)}) as registration fee.*`)}else f("")},[a,n,d]);const W=()=>{const t=a===""?0:Number(a),N=l===""?0:Number(l),x=E===""?0:Number(E);i==="FIXED_PRICE"?n||C(t,0,i,0):!h&&!n&&!v&&C(t,N,i,x)},F=t=>{K(t.currentTarget),g(!0)},r=()=>{g(!1),K(null)},w=t=>{R(t),t==="FIXED_PRICE"&&(A("0"),k("0"))};return e.jsx(ce,{open:o,onClose:y,children:e.jsxs(te,{sx:{padding:4,background:"#fff",borderRadius:2,maxWidth:500,margin:"auto",marginTop:"100px",boxShadow:3,position:"relative"},children:[e.jsx("div",{onMouseEnter:F,onMouseLeave:r,style:{position:"absolute",right:"16px",top:"16px",cursor:"pointer"},children:e.jsxs(P,{variant:"body2",color:"textSecondary",className:"font-bold",children:["Rules of registration Â ",e.jsx(le,{title:"Rules",children:e.jsx(Ee,{color:"primary"})})]})}),b&&M&&e.jsx(De,{open:b,onClose:()=>g(!1),anchorEl:M}),e.jsx(P,{variant:"h6",component:"h2",gutterBottom:!0,children:"Register Koi for Auction"}),e.jsxs(P,{variant:"body2",color:"textSecondary",children:["Koi ID: ",p]}),e.jsxs(P,{variant:"body2",color:"textSecondary",children:["Auction ID: ",c]}),e.jsxs(L,{label:"Bid Method",select:!0,variant:"outlined",fullWidth:!0,margin:"normal",value:i,onChange:t=>w(t.target.value),children:[e.jsx(H,{value:"ASCENDING_BID",children:"Ascending Bid"}),e.jsx(H,{value:"DESCENDING_BID",children:"Descending Bid"}),e.jsx(H,{value:"FIXED_PRICE",children:"Fixed Price"})]}),e.jsx(L,{label:"Base Price (VND)",type:"number",variant:"outlined",fullWidth:!0,margin:"normal",value:a,onChange:t=>T(t,"basePrice"),placeholder:"Enter base price (VND)",error:!!n,inputProps:U}),n&&e.jsx(V,{error:!0,children:n}),B&&Number(a)>=d&&e.jsx(V,{sx:{color:"green"},children:B}),e.jsx(L,{label:"Bid Step (VND)",type:"number",variant:"outlined",fullWidth:!0,margin:"normal",value:l,onChange:t=>T(t,"bidStep"),placeholder:"Enter bid step (VND)",error:!!h,disabled:i==="FIXED_PRICE",inputProps:U}),h&&e.jsx(V,{error:!0,children:h}),e.jsx(L,{label:"Ceiling Price (VND)",type:"number",variant:"outlined",fullWidth:!0,margin:"normal",value:E,onChange:t=>T(t,"ceilPrice"),placeholder:"Enter ceiling price (VND)",disabled:i==="FIXED_PRICE",error:!!v,inputProps:U}),v&&e.jsx(V,{error:!0,children:v}),e.jsxs(te,{sx:{display:"flex",justifyContent:"space-between",marginTop:2},children:[e.jsx(Y,{variant:"contained",color:"success",sx:{":hover":{backgroundColor:"#4caf50"}},onClick:W,disabled:i==="FIXED_PRICE"?!!n:!!h||!!n||!!v,children:"Submit"}),e.jsx(Y,{variant:"contained",color:"error",sx:{":hover":{backgroundColor:"#f44336"}},onClick:y,children:"Cancel"})]})]})})},_e=({auction_id:o,onKoiRegistered:y})=>{var F;const[p,c]=s.useState([]),[d,C]=s.useState(!0),[l,A]=s.useState(null),[a,_]=s.useState(0),i=re(),[R,E]=s.useState(0),[k,h]=s.useState(0),u=8,[n,m]=s.useState(null),[v,I]=s.useState(!1),[B,f]=s.useState(!1),b=de(),g=ae("user_id");if(s.useEffect(()=>{(!b||!g)&&i("/notfound")},[b,g,i]),!b||!g)return null;s.useEffect(()=>{(async()=>{C(!0);try{const t=await se(parseInt(g),a,u);if(t&&Array.isArray(t.item))c(t.item),E(t.total_item),h(t.total_page);else throw new Error("Unexpected data structure from API")}catch(w){const t=ee(w,X.FETCH_KOI_ERROR);A(t),O.error(t)}finally{C(!1)}})()},[a,u,b,g]);const M=(r,w)=>{_(w)},K=r=>{i(`/kois/${r}`)},T=r=>{m(r),f(!0)},W=async(r,w,t,N)=>{if(!n||!o){O.error(X.SELECT_KOI_AND_AUCTION);return}try{const x=await ve(n,o,r,w,t,N,b);O.success(me.REGISTER_KOI_SUCCESS),f(!1);const j=await se(parseInt(g),a,u);j&&Array.isArray(j.item)&&(c(j.item),h(j.total_page)),setTimeout(()=>{y==null||y()},5e3)}catch(x){const j=ee(x,X.REGISTER_KOI_FAILED);O.error(j)}};return d?e.jsx(J,{className:"flex justify-center items-center h-screen",children:e.jsx(ie,{})}):l?e.jsx(J,{className:"mt-4",children:e.jsx(Pe,{severity:"error",children:l})}):e.jsxs("div",{className:"w-full overflow-x-auto p-10",children:[e.jsx("div",{children:e.jsxs(P,{variant:"h4",className:"mb-4",children:["Total koi not in auction: ",R]})}),e.jsx("div",{className:"overflow-hidden px-4 py-4 sm:-mx-8 sm:px-8",children:e.jsxs("div",{className:"inline-block min-w-full overflow-hidden rounded-lg shadow",children:[e.jsxs("table",{className:"min-w-full leading-normal",children:[e.jsx(ge,{headers:Ne}),e.jsx("tbody",{children:p.length>0?p.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.id||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.name||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.sex||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.length||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.year_born||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"h-30 w-10 flex-shrink-0",children:e.jsx("img",{className:"h-full w-full rounded-full object-cover",src:r.thumbnail,alt:r.thumbnail})})})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:S(r.base_price)||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.status_name||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:je(r.category_id)})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{onClick:()=>K(r.id),ariaLabel:"View",svgPath:"view.svg"}),e.jsx(Z,{onClick:()=>T(r.id),ariaLabel:"Push",svgPath:"approve.svg"})]})})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"border-b border-gray-200 bg-white px-5 py-5 text-lg text-center text-red-500",children:"No verified kois found."})})})]}),e.jsx("div",{className:"flex gap-4 justify-center",children:e.jsx(Ae,{open:B,onClose:()=>f(!1),koiId:n??0,auctionId:o??0,basePrice:(F=p.filter(r=>r.id===n)[0])==null?void 0:F.base_price,onSubmit:W})}),e.jsx("div",{className:"xs:flex-row xs:justify-between flex flex-col items-center border-t bg-white px-5 py-5",children:e.jsx(ye,{totalPages:k,currentPage:a,onPageChange:M})})]})}),e.jsx(ue,{})]})},rt=()=>{const{isLoggedIn:o,user:y}=xe(),{id:p}=pe(),[c,d]=s.useState(null),[C,l]=s.useState([]),[A,a]=s.useState(!0),[_,i]=s.useState(null),R=re(),E=ae("access_token"),[k,h]=s.useState(0);return s.useEffect(()=>{if(!E)return;(async()=>{a(!0);try{const n=await Ce(Number(p));if(n){d(n);const m=await we(n.id);if(m){const v=m.map(f=>Ie(f.koi_id)),B=(await Promise.all(v)).map((f,b)=>({...f,auctionKoiData:m[b]}));l(B)}}else i("No Upcoming Auction Found.")}catch{i("Error fetching auction data.")}finally{a(!1)}})()},[p,E,k]),A?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(ie,{})}):_?e.jsx("div",{className:"py-8 text-center text-red-500",children:_}):c?(E||R("/login"),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col mt-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-col items-start pl-6 ml-5 mt-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-xl text-black",children:"Auction Name: "}),e.jsx("h2",{className:"text-2xl font-semibold text-black",children:c.title})]}),e.jsx("div",{className:"",children:e.jsxs("span",{className:`rounded-lg px-4 py-2 text-lg font-bold ${fe(c.status)}`,children:["Status: ",c.status]})}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-xl text-black",children:"Start Time: "}),e.jsx("span",{className:"text-xl text-black glow-text",children:c.start_time.toString()})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-xl text-black",children:"End Time: "}),e.jsx("span",{className:"text-xl text-black glow-text",children:c.end_time.toString()})]}),e.jsx("div",{className:" mt-5",children:e.jsx("span",{className:"text-xl text-black glow-text",children:be(c.start_time.toString(),c.end_time.toString())})})]}),e.jsxs(P,{variant:"h4",className:"text-center mt-5",children:["*Note: This koi is already registered in the ",c.title,"."]}),e.jsx(he,{kois:C,auction:c}),e.jsx(_e,{auction_id:c.id,onKoiRegistered:()=>h(u=>u+1)})]})})):e.jsx("div",{className:"py-8 text-center text-red-500",children:"No Upcoming Auction Found."})};export{rt as default};
