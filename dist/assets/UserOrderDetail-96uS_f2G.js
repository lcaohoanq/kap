import{H as ie,I as le,g as l,J as he,K as ke,T as n,l as e,N as se,P as L,U as K,V as de,X as ce,F as W,W as Re,an as Oe,Y as fe,Z as ge,ao as Me,ap as Le,aq as Ae,t as Be,B as M,a9 as ee,z as F,ar as te,as as Ee,a4 as Ge,q as $e,al as ze,a8 as Te,am as Ve,L as We,y as Ue,at as qe,au as He,av as Ye,Q as Qe,aj as Ke}from"./index-D5S7yFe7.js";import{E as Fe}from"./Edit-dCW7BPPT.js";import{O as R}from"./orders.type-CY8k0T_M.js";import{f as Ze,a as Je,b as ye,u as Xe,c as et}from"./order.apis-C9ZczIFA.js";import{R as be,g as tt,s as rt}from"./feedback.apis-DLTTziLM.js";import{A as st}from"./Alert-qDdGi1aw.js";import{B as f}from"./Box-BhEgB52r.js";import{T as Y}from"./TextField-CsRXday1.js";import{k as ot}from"./koibreeders-C8vjzIiM.js";import{f as q}from"./currencyUtils-DiCxv8hG.js";import{D as at}from"./Divider-BKODcYVg.js";import{u as me}from"./useFormControl-UCy3dLy1.js";import{f as De,F as oe,I as ae,S as ne}from"./Select-DtV6tKvQ.js";import{S as nt}from"./SwitchBase-CzPVftSR.js";import{G as V,D as it}from"./Grid-CNv4Z6tC.js";import{M as re}from"./MenuItem-DhLzwMG1.js";import{f as ve,a as je}from"./format-BOZTN9QO.js";import{c as lt}from"./payment.apis-DezAi0dw.js";import{u as dt}from"./index-D1RPwHMf.js";import"./environment-ynMLDg3_.js";import"./dividerClasses-C6h65s1S.js";function ct(t){return le("MuiFormControlLabel",t)}const X=ie("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),pt=t=>{const{classes:r,disabled:d,labelPlacement:i,error:h,required:j}=t,v={root:["root",d&&"disabled",`labelPlacement${K(i)}`,h&&"error",j&&"required"],label:["label",d&&"disabled"],asterisk:["asterisk",h&&"error"]};return de(v,ct,r)},ut=L("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:d}=t;return[{[`& .${X.label}`]:r.label},r.root,r[`labelPlacement${K(d.labelPlacement)}`]]}})(ce(({theme:t})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${X.disabled}`]:{cursor:"default"},[`& .${X.label}`]:{[`&.${X.disabled}`]:{color:(t.vars||t).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:r})=>r==="start"||r==="top"||r==="bottom",style:{marginLeft:16}}]}))),ht=L("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(t,r)=>r.asterisk})(ce(({theme:t})=>({[`&.${X.error}`]:{color:(t.vars||t).palette.error.main}}))),Ce=l.forwardRef(function(r,d){const i=he({props:r,name:"MuiFormControlLabel"}),{checked:h,className:j,componentsProps:v={},control:y,disabled:C,disableTypography:_,inputRef:D,label:p,labelPlacement:b="end",name:m,onChange:G,required:I,slots:a={},slotProps:k={},value:S,...w}=i,N=me(),$=C??y.props.disabled??(N==null?void 0:N.disabled),O=I??y.props.required,B={disabled:$,required:O};["checked","name","onChange","value","inputRef"].forEach(g=>{typeof y.props[g]>"u"&&typeof i[g]<"u"&&(B[g]=i[g])});const A=De({props:i,muiFormControl:N,states:["error"]}),c={...i,disabled:$,labelPlacement:b,required:O,error:A.error},E=pt(c),U={slots:a,slotProps:{...v,...k}},[T,s]=ke("typography",{elementType:n,externalForwardedProps:U,ownerState:c});let u=p;return u!=null&&u.type!==n&&!_&&(u=e.jsx(T,{component:"span",...s,className:se(E.label,s==null?void 0:s.className),children:u})),e.jsxs(ut,{className:se(E.root,j),ownerState:c,ref:d,...w,children:[l.cloneElement(y,B),O?e.jsxs("div",{children:[u,e.jsxs(ht,{ownerState:c,"aria-hidden":!0,className:E.asterisk,children:["â€‰","*"]})]}):u]})});function mt(t){return le("MuiFormGroup",t)}ie("MuiFormGroup",["root","row","error"]);const xt=t=>{const{classes:r,row:d,error:i}=t;return de({root:["root",d&&"row",i&&"error"]},mt,r)},ft=L("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:d}=t;return[r.root,d.row&&r.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),gt=l.forwardRef(function(r,d){const i=he({props:r,name:"MuiFormGroup"}),{className:h,row:j=!1,...v}=i,y=me(),C=De({props:i,muiFormControl:y,states:["error"]}),_={...i,row:j,error:C.error},D=xt(_);return e.jsx(ft,{className:se(D.root,h),ownerState:_,ref:d,...v})}),yt=W(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"RadioButtonUnchecked"),bt=W(e.jsx("path",{d:"M8.465 8.465C9.37 7.56 10.62 7 12 7C14.76 7 17 9.24 17 12C17 13.38 16.44 14.63 15.535 15.535C14.63 16.44 13.38 17 12 17C9.24 17 7 14.76 7 12C7 10.62 7.56 9.37 8.465 8.465Z"}),"RadioButtonChecked"),vt=L("span",{shouldForwardProp:Re})({position:"relative",display:"flex"}),jt=L(yt)({transform:"scale(1)"}),Ct=L(bt)(ce(({theme:t})=>({left:0,position:"absolute",transform:"scale(0)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeIn,duration:t.transitions.duration.shortest}),variants:[{props:{checked:!0},style:{transform:"scale(1)",transition:t.transitions.create("transform",{easing:t.transitions.easing.easeOut,duration:t.transitions.duration.shortest})}}]})));function Ie(t){const{checked:r=!1,classes:d={},fontSize:i}=t,h={...t,checked:r};return e.jsxs(vt,{className:d.root,ownerState:h,children:[e.jsx(jt,{fontSize:i,className:d.background,ownerState:h}),e.jsx(Ct,{fontSize:i,className:d.dot,ownerState:h})]})}const Ne=l.createContext(void 0);function St(){return l.useContext(Ne)}function wt(t){return le("MuiRadio",t)}const Se=ie("MuiRadio",["root","checked","disabled","colorPrimary","colorSecondary","sizeSmall"]),_t=t=>{const{classes:r,color:d,size:i}=t,h={root:["root",`color${K(d)}`,i!=="medium"&&`size${K(i)}`]};return{...r,...de(h,wt,r)}},Pt=L(nt,{shouldForwardProp:t=>Re(t)||t==="classes",name:"MuiRadio",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:d}=t;return[r.root,d.size!=="medium"&&r[`size${K(d.size)}`],r[`color${K(d.color)}`]]}})(ce(({theme:t})=>({color:(t.vars||t).palette.text.secondary,[`&.${Se.disabled}`]:{color:(t.vars||t).palette.action.disabled},variants:[{props:{color:"default",disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.activeChannel} / ${t.vars.palette.action.hoverOpacity})`:fe(t.palette.action.active,t.palette.action.hoverOpacity)}}},...Object.entries(t.palette).filter(ge()).map(([r])=>({props:{color:r,disabled:!1,disableRipple:!1},style:{"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:fe(t.palette[r].main,t.palette.action.hoverOpacity)}}})),...Object.entries(t.palette).filter(ge()).map(([r])=>({props:{color:r,disabled:!1},style:{[`&.${Se.checked}`]:{color:(t.vars||t).palette[r].main}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]})));function kt(t,r){return typeof r=="object"&&r!==null?t===r:String(t)===String(r)}const Rt=e.jsx(Ie,{checked:!0}),Et=e.jsx(Ie,{}),we=l.forwardRef(function(r,d){const i=he({props:r,name:"MuiRadio"}),{checked:h,checkedIcon:j=Rt,color:v="primary",icon:y=Et,name:C,onChange:_,size:D="medium",className:p,disabled:b,disableRipple:m=!1,slots:G={},slotProps:I={},inputProps:a,...k}=i,S=me();let w=b;S&&typeof w>"u"&&(w=S.disabled),w??(w=!1);const N={...i,disabled:w,disableRipple:m,color:v,size:D},$=_t(N),O=St();let B=h;const A=Oe(_,O&&O.onChange);let c=C;O&&(typeof B>"u"&&(B=kt(O.value,i.value)),typeof c>"u"&&(c=O.name));const E=I.input??a,[U,T]=ke("root",{ref:d,elementType:Pt,className:se($.root,p),shouldForwardComponentProp:!0,externalForwardedProps:{slots:G,slotProps:I,...k},getSlotProps:s=>({...s,onChange:(u,...g)=>{var P;(P=s.onChange)==null||P.call(s,u,...g),A(u,...g)}}),ownerState:N,additionalProps:{type:"radio",icon:l.cloneElement(y,{fontSize:y.props.fontSize??D}),checkedIcon:l.cloneElement(j,{fontSize:j.props.fontSize??D}),disabled:w,name:c,checked:B,slots:G,slotProps:{input:typeof E=="function"?E(N):E}}});return e.jsx(U,{...T,classes:$})});function Ft(t){return le("MuiRadioGroup",t)}ie("MuiRadioGroup",["root","row","error"]);const Dt=t=>{const{classes:r,row:d,error:i}=t;return de({root:["root",d&&"row",i&&"error"]},Ft,r)},It=l.forwardRef(function(r,d){const{actions:i,children:h,className:j,defaultValue:v,name:y,onChange:C,value:_,...D}=r,p=l.useRef(null),b=Dt(r),[m,G]=Me({controlled:_,default:v,name:"RadioGroup"});l.useImperativeHandle(i,()=>({focus:()=>{let S=p.current.querySelector("input:not(:disabled):checked");S||(S=p.current.querySelector("input:not(:disabled)")),S&&S.focus()}}),[]);const I=Le(d,p),a=Ae(y),k=l.useMemo(()=>({name:a,onChange(S){G(S.target.value),C&&C(S,S.target.value)},value:m}),[a,C,G,m]);return e.jsx(Ne.Provider,{value:k,children:e.jsx(gt,{role:"radiogroup",ref:I,className:se(b.root,j),...D,children:h})})}),_e=W(e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment"),Nt=W(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Ot=({orderId:t})=>{const[r,d]=l.useState(null),[i,h]=l.useState(0),[j,v]=l.useState(""),[y,C]=l.useState(null),_=Be();l.useEffect(()=>{(async()=>{try{if(t){const b=await Ze(Number(t),ee()||"");if(d(b),b.status===R.DELIVERED){const m=await tt(Number(t),ee()||"");m&&(C(m),h(m.rating),v(m.content))}}}catch(b){console.error("Error fetching order and feedback:",b),F.error("Failed to fetch order details or feedback")}})()},[t]);const D=async p=>{var b;if(p.preventDefault(),!i){F.error("Please provide a rating");return}try{const m={content:j,rating:i,order_id:Number(t),user_id:((b=_==null?void 0:_.user)==null?void 0:b.id)||0};await rt(m,ee()||""),F.success("Feedback submitted successfully"),C(m)}catch(m){console.error("Error submitting feedback:",m),F.error("Failed to submit feedback")}};return r?r.status!==R.DELIVERED?e.jsx(st,{severity:"info",children:"Feedback can only be submitted for delivered orders."}):y?e.jsxs(f,{children:[e.jsx(n,{variant:"h5",gutterBottom:!0,children:"Your Feedback"}),e.jsxs(f,{sx:{mb:3},children:[e.jsx(n,{component:"legend",children:"Rating"}),e.jsx(be,{name:"read-only",value:y.rating,readOnly:!0})]}),e.jsx(n,{variant:"body1",gutterBottom:!0,children:y.content})]}):e.jsxs(f,{children:[e.jsx(n,{variant:"h5",gutterBottom:!0,children:"Leave Feedback"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs(f,{sx:{mb:3},children:[e.jsx(n,{component:"legend",children:"Rating"}),e.jsx(be,{name:"rating",value:i,onChange:(p,b)=>{h(b)}})]}),e.jsx(Y,{fullWidth:!0,multiline:!0,rows:4,variant:"outlined",label:"Your Feedback",value:j,onChange:p=>v(p.target.value),sx:{mb:3}}),e.jsx(M,{type:"submit",variant:"contained",color:"primary",children:"Submit Feedback"})]})]}):e.jsx(n,{children:"Loading..."})},Mt=W(e.jsx("path",{d:"M18 6h-2c0-2.21-1.79-4-4-4S8 3.79 8 6H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2m-8 4c0 .55-.45 1-1 1s-1-.45-1-1V8h2zm2-6c1.1 0 2 .9 2 2h-4c0-1.1.9-2 2-2m4 6c0 .55-.45 1-1 1s-1-.45-1-1V8h2z"}),"ShoppingBag"),Lt=W(e.jsx("path",{d:"m21.9 8.89-1.05-4.37c-.22-.9-1-1.52-1.91-1.52H5.05c-.9 0-1.69.63-1.9 1.52L2.1 8.89c-.24 1.02-.02 2.06.62 2.88.08.11.19.19.28.29V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-6.94c.09-.09.2-.18.28-.28.64-.82.87-1.87.62-2.89m-2.99-3.9 1.05 4.37c.1.42.01.84-.25 1.17-.14.18-.44.47-.94.47-.61 0-1.14-.49-1.21-1.14L16.98 5zM13 5h1.96l.54 4.52c.05.39-.07.78-.33 1.07-.22.26-.54.41-.95.41-.67 0-1.22-.59-1.22-1.31zM8.49 9.52 9.04 5H11v4.69c0 .72-.55 1.31-1.29 1.31-.34 0-.65-.15-.89-.41-.25-.29-.37-.68-.33-1.07m-4.45-.16L5.05 5h1.97l-.58 4.86c-.08.65-.6 1.14-1.21 1.14-.49 0-.8-.29-.93-.47-.27-.32-.36-.75-.26-1.17M5 19v-6.03c.08.01.15.03.23.03.87 0 1.66-.36 2.24-.95.6.6 1.4.95 2.31.95.87 0 1.65-.36 2.23-.93.59.57 1.39.93 2.29.93.84 0 1.64-.35 2.24-.95.58.59 1.37.95 2.24.95.08 0 .15-.02.23-.03V19z"}),"Storefront"),At=W(e.jsx("path",{d:"M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5m13.5-9 1.96 2.5H17V9.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"LocalShipping"),Bt=W(e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7m0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5"}),"LocationOn"),Gt=t=>{try{const r=t.split(", ");return{street_address:r[0]||"",ward:r[1]||"",ward_code:"",district:r[2]||"",district_code:"",province:r[3]||"",province_code:""}}catch{return{street_address:"",ward:"",ward_code:"",district:"",district_code:"",province:"",province_code:""}}},Pe=t=>`${t.street_address}, ${t.ward}, ${t.district}, ${t.province}`.trim(),Q={standard:5e5,express:1e6},$t=({order:t,onTempUpdate:r,onSave:d})=>{const[i,h]=l.useState(!1),[j,v]=l.useState([]),[y,C]=l.useState([]),[_,D]=l.useState([]),[p,b]=l.useState(Gt(t.shipping_address)),[m,G]=l.useState(t.shipping_method==="Express"?"Express":"Standard"),[I,a]=l.useState(t.phone_number),[k,S]=l.useState(t.first_name),[w,N]=l.useState(t.last_name);l.useEffect(()=>{(async()=>{try{const g=await(await fetch("https://provinces.open-api.vn/api/p/")).json();v(g)}catch(u){console.error("Error fetching provinces:",u)}})()},[]);const $=async s=>{const u=s.target.value,g=j.find(P=>P.code===u);b({...p,province:(g==null?void 0:g.name)||"",province_code:u,district:"",district_code:"",ward:"",ward_code:""});try{const Z=await(await fetch(`https://provinces.open-api.vn/api/p/${u}?depth=2`)).json();C(Z.districts)}catch(P){console.error("Error fetching districts:",P)}},O=async s=>{const u=s.target.value,g=y.find(P=>P.code===u);b({...p,district:(g==null?void 0:g.name)||"",district_code:u,ward:"",ward_code:""});try{const Z=await(await fetch(`https://provinces.open-api.vn/api/d/${u}?depth=2`)).json();D(Z.wards)}catch(P){console.error("Error fetching wards:",P)}},B=s=>{const u=s.target.value,g=_.find(P=>P.code===u);b({...p,ward:(g==null?void 0:g.name)||"",ward_code:u})},A=s=>ve(je(new Date,s==="Standard"?7:3),"MMM dd, yyyy"),c=/^\d{10}$/,E=()=>{const s=Pe(p),u=ve(je(new Date,m==="Standard"?7:3),"yyyy-MM-dd");r({shipping_address:s,shipping_method:m,shipping_date:u}),h(!1)},U=()=>k.trim()!==""&&w.trim()!==""&&p.street_address.trim()!==""&&p.province_code!==""&&p.district_code!==""&&p.ward_code!==""&&c.test(I),T=s=>{if(t.status!==R.PENDING)return;const u=s.target.value;G(u),r({shipping_method:u})};return e.jsxs(te,{sx:{p:3,mb:2},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsxs(n,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(Bt,{})," Shipping Information"]}),t.status===R.PENDING&&e.jsx(M,{startIcon:e.jsx(Fe,{}),onClick:()=>h(!0),children:"Edit"})]}),e.jsxs(f,{sx:{mb:3},children:[e.jsx(n,{variant:"subtitle1",children:"Delivery Address"}),e.jsxs(n,{children:[t.first_name," ",t.last_name," | ",t.phone_number]}),e.jsx(n,{children:t.shipping_address})]}),e.jsx(at,{sx:{my:2}}),e.jsxs(f,{sx:{mb:3},children:[e.jsxs(n,{variant:"subtitle1",sx:{mb:2},children:[e.jsx(At,{})," Shipping Method"]}),e.jsxs(It,{value:m,onChange:T,children:[e.jsx(te,{variant:"outlined",sx:{mb:1,p:2},children:e.jsx(Ce,{value:"Standard",control:e.jsx(we,{}),label:e.jsxs(f,{children:[e.jsx(n,{variant:"subtitle2",children:"Standard Delivery"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Estimated delivery: ",A("Standard")]}),e.jsx(n,{variant:"body2",color:"primary",children:q(Q.standard)})]}),disabled:t.status!==R.PENDING})}),e.jsx(te,{variant:"outlined",sx:{p:2},children:e.jsx(Ce,{value:"Express",control:e.jsx(we,{}),label:e.jsxs(f,{children:[e.jsx(n,{variant:"subtitle2",children:"Express Delivery"}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["Estimated delivery: ",A("Express")]}),e.jsx(n,{variant:"body2",color:"primary",children:q(Q.express)})]}),disabled:t.status!==R.PENDING})})]})]}),e.jsxs(f,{sx:{mt:2,p:2,bgcolor:"background.paper",borderRadius:1},children:[e.jsx(n,{variant:"subtitle2",children:"Selected Shipping Option:"}),e.jsxs(n,{children:[m==="Standard"?"Standard Delivery":"Express Delivery"," - ",q(m==="Standard"?Q.standard:Q.express)]})]}),e.jsx(Ee,{open:i,onClose:()=>h(!1),maxWidth:"md",fullWidth:!0,children:e.jsxs(f,{sx:{p:3},children:[e.jsx(n,{variant:"h6",sx:{mb:3},children:"Edit Shipping Address"}),e.jsxs(V,{container:!0,spacing:2,children:[e.jsx(V,{item:!0,xs:12,md:6,children:e.jsx(Y,{fullWidth:!0,label:"First Name",value:k,onChange:s=>{S(s.target.value),r({first_name:s.target.value})},required:!0,error:!k,helperText:!k&&"First name is required",sx:{mb:2}})}),e.jsx(V,{item:!0,xs:12,md:6,children:e.jsx(Y,{fullWidth:!0,label:"Last Name",value:w,onChange:s=>{N(s.target.value),r({last_name:s.target.value})},required:!0,error:!w,helperText:!w&&"Last name is required",sx:{mb:2}})}),e.jsx(V,{item:!0,xs:12,children:e.jsx(Y,{fullWidth:!0,label:"Phone Number",value:I,onChange:s=>{a(s.target.value),r({phone_number:s.target.value})},inputProps:{minLength:5},error:!c.test(I),helperText:!c.test(I)&&"Phone number must be 10 digits long and contain only numbers",sx:{mb:2}})}),e.jsx(V,{item:!0,xs:12,md:4,children:e.jsxs(oe,{fullWidth:!0,children:[e.jsx(ae,{children:"Province"}),e.jsx(ne,{value:p.province_code,onChange:$,label:"Province",children:j.map(s=>e.jsx(re,{value:s.code,children:s.name},s.code))})]})}),e.jsx(V,{item:!0,xs:12,md:4,children:e.jsxs(oe,{fullWidth:!0,disabled:!p.province_code,children:[e.jsx(ae,{children:"District"}),e.jsx(ne,{value:p.district_code,onChange:O,label:"District",children:y.map(s=>e.jsx(re,{value:s.code,children:s.name},s.code))})]})}),e.jsx(V,{item:!0,xs:12,md:4,children:e.jsxs(oe,{fullWidth:!0,disabled:!p.district_code,children:[e.jsx(ae,{children:"Ward"}),e.jsx(ne,{value:p.ward_code,onChange:B,label:"Ward",children:_.map(s=>e.jsx(re,{value:s.code,children:s.name},s.code))})]})}),e.jsx(V,{item:!0,xs:12,children:e.jsx(Y,{fullWidth:!0,label:"Street Address",value:p.street_address,onChange:s=>b({...p,street_address:s.target.value}),inputProps:{required:!0},error:!p.street_address,helperText:!p.street_address&&"Street address is required"})})]}),e.jsxs(f,{sx:{mt:3,display:"flex",justifyContent:"flex-end",gap:2},children:[e.jsx(M,{onClick:()=>{h(!1),S(t.first_name),N(t.last_name),a(t.phone_number)},children:"Cancel"}),e.jsx(M,{variant:"contained",onClick:()=>{E(),r({first_name:k,last_name:w,phone_number:I,shipping_address:Pe(p),shipping_method:m})},disabled:!U(),children:"Save Changes"})]})]})})]})};L(M)(({theme:t})=>({color:t.palette.grey[800],borderColor:t.palette.grey[300],"&:hover":{borderColor:t.palette.grey[500]}}));const zt=L(f)(({theme:t})=>({backgroundColor:t.palette.primary.main,color:"white",padding:t.spacing(2),borderRadius:t.shape.borderRadius,marginBottom:t.spacing(3)})),H=L(te)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(3),borderRadius:t.shape.borderRadius})),ue=L(f)(({theme:t})=>({borderBottom:`1px solid ${t.palette.divider}`,paddingBottom:t.spacing(2),marginBottom:t.spacing(2)})),Tt=L(f)(({theme:t})=>({display:"flex",padding:t.spacing(2),borderBottom:`1px solid ${t.palette.divider}`,"&:last-child":{borderBottom:"none"}})),cr=()=>{const{orderId:t}=Ge(),r=$e(),d=ze(),[i,h]=l.useState([]),[j,v]=l.useState(!0),[y,C]=l.useState(null),[_,D]=l.useState(!1),[p,b]=l.useState(null),{data:m,isLoading:G,error:I}=Te(),[a,k]=l.useState(null);dt(d.breakpoints.down("sm"));const[S,w]=l.useState(!1),[N,$]=l.useState(""),[O,B]=l.useState(""),A=ee()||"",[c,E]=l.useState({});l.useEffect(()=>{A&&t&&(v(!0),C(null),Promise.all([Je(parseInt(t)),ye(parseInt(t))]).then(([o,x])=>{if(o)k(o);else throw new Error("Failed to fetch order");if(Array.isArray(x))h(x);else throw new Error("Invalid order details format")}).catch(o=>{console.error("Error fetching order data:",o),C(o.message||"Failed to fetch order data"),F.error("Failed to load order information")}).finally(()=>{v(!1)}))},[t,A,r]);const U=async()=>{if(a)try{const o={payment_amount:a.total_money,payment_method:a.payment_method,payment_type:"ORDER",order_id:a.id,user_id:(m==null?void 0:m.id)||0,bank_number:null,bank_name:null},x=await lt(o,Ke("access_token")||"");if(x)if(a.payment_method==="Cash")F.success("Cash payment recorded successfully");else if(x.paymentUrl)window.location.href=x.paymentUrl;else throw new Error("No payment URL received for online payment");else throw new Error("Failed to create payment")}catch(o){console.error("Error processing payment:",o),o instanceof Error?F.error(o.message):F.error("Failed to process payment. Please try again.")}},T=async o=>{if(a&&a.id)try{const x=await et(a.id,o,ee()||"");k(x),F.success(`Order status updated to ${o} successfully`)}catch(x){console.error("Error updating order status:",x),F.error("Failed to update order status. Please try again.")}},s=(o,x)=>{$(o),B(x),w(!0)},u=()=>{w(!1)},g=async()=>{switch(w(!1),N){case"payment":await U();break;case"delivery":await T(R.DELIVERED);break;case"cancel":await T(R.CANCELLED);break;case"save":try{const o={...a,...c,total_money:J(a,c)};v(!0);const x=await Xe(o,A);if(x){k(x),E({}),F.success("Order saved successfully");try{const z=await ye(x.id);Array.isArray(z)&&h(z)}catch(z){console.error("Error refreshing details:",z)}}else throw new Error("Failed to update order")}catch(o){console.error("Error saving order:",o),F.error("Failed to save order changes"),C("Failed to save order changes")}finally{v(!1)}break}},P=o=>{if(o.shipping_address===void 0||o.phone_number===void 0){F.error("Shipping address and phone number are required to save the order");return}E(x=>({...x,...o}))},Z=async()=>{if(!(!A||!a))try{const o=J(a,c),x={...a,...c,total_money:o};E(x),s("save","Are you sure you want to save all changes to this order?")}catch(o){console.error("Error saving order:",o),F.error("Failed to save order changes")}},pe=o=>{E(x=>{const z={...x,...o};if(o.shipping_method){const xe=J(a,z);z.total_money=xe}return z})},J=(o,x)=>(x.shipping_method||o.shipping_method)==="Express"?Q.express:Q.standard;return e.jsxs(Ve,{maxWidth:"lg",sx:{py:4},children:[a&&e.jsx(zt,{children:e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(n,{variant:"h6",children:["Order #",t]}),e.jsxs(f,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(n,{children:"Status:"}),e.jsx(n,{variant:"h6",sx:{fontWeight:"bold"},children:a.status})]})]})}),j&&e.jsx(We,{}),y&&e.jsx(n,{color:"error",children:y}),a&&i.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(ue,{children:e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(n,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(Mt,{sx:{verticalAlign:"middle",mr:1}}),"Products"]}),ot.find(o=>o.id===i[0].product_id.owner_id)&&e.jsx(Ue,{to:`/breeder/${i[0].product_id.owner_id}/info`,style:{textDecoration:"none"},children:e.jsx(M,{variant:"outlined",startIcon:e.jsx(Lt,{}),size:"small",children:"Visit Store"})})]})}),i.map(o=>e.jsxs(Tt,{children:[e.jsx(f,{sx:{width:100,height:100,backgroundColor:"rgb(79 146 209)",borderRadius:1,mr:2,overflow:"hidden"},children:e.jsx("img",{src:o.product_id.thumbnail,alt:o.product_id.name,style:{width:"100%",height:"100%",objectFit:"contain"}})}),e.jsxs(f,{flex:1,children:[e.jsx(n,{variant:"subtitle1",fontWeight:"bold",children:o.product_id.name}),e.jsxs(n,{color:"text.secondary",gutterBottom:!0,children:["Quantity: ",i.length]}),e.jsx(n,{color:"primary",fontWeight:"bold",children:q(o.total_money)})]})]},o.id)),e.jsxs(f,{sx:{mt:2,p:2,backgroundColor:"#f5f5f5",borderRadius:1},children:[e.jsxs(f,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(n,{color:"text.secondary",children:"Subtotal (Already Paid):"}),e.jsx(n,{color:"text.secondary",sx:{textDecoration:"line-through",opacity:.7},children:q(i.reduce((o,x)=>o+x.total_money,0))})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(n,{children:"Shipping Fee:"}),e.jsx(n,{children:q(J(a,c))})]}),e.jsxs(f,{display:"flex",justifyContent:"space-between",children:[e.jsx(n,{variant:"h6",children:"Total to Pay:"}),e.jsx(n,{variant:"h6",color:"primary.main",children:q(J(a,c))})]})]})]}),e.jsx(H,{children:a&&e.jsx($t,{order:{...a,...c},onTempUpdate:pe,onSave:P})}),e.jsxs(H,{children:[e.jsx(ue,{children:e.jsxs(n,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(Fe,{sx:{verticalAlign:"middle",mr:1}}),"Order Notes"]})}),e.jsx(Y,{fullWidth:!0,multiline:!0,rows:4,label:"Notes for your order",value:c.note||a.note||"",onChange:o=>pe({note:o.target.value}),placeholder:"Add any special instructions or notes for your order here...",sx:{mt:2},disabled:a.status!==R.PENDING})]}),Object.keys(c).length>0&&e.jsxs(H,{children:[e.jsx(n,{variant:"h6",sx:{mb:2},children:"Pending Changes"}),c.shipping_method&&e.jsxs(n,{children:["Shipping Method:"," ",c.shipping_method==="Standard"?"Standard":"Express"," ","Delivery"]}),c.phone_number&&e.jsxs(n,{children:["Phone Number: ",c.phone_number]}),c.note&&e.jsxs(n,{children:["Note: ",c.note]})]}),e.jsxs(H,{children:[e.jsx(ue,{children:e.jsxs(n,{variant:"h6",sx:{color:"primary.main"},children:[e.jsx(_e,{sx:{verticalAlign:"middle",mr:1}}),"Payment Information"]})}),e.jsxs(oe,{fullWidth:!0,sx:{mt:2},children:[e.jsx(ae,{id:"payment-method-label",children:"Payment Method"}),e.jsxs(ne,{labelId:"payment-method-label",id:"payment-method",value:c.payment_method||a.payment_method,label:"Payment Method",onChange:o=>pe({payment_method:o.target.value}),disabled:a.status!==R.PENDING,children:[e.jsx(re,{value:"Cash",children:"Cash"}),e.jsx(re,{value:"Payment",children:"Online Payment"})]})]}),e.jsx(n,{sx:{mt:2,color:"text.secondary",fontSize:"0.875rem"},children:c.payment_method==="Payment"||a.payment_method==="Payment"&&!c.payment_method?"You will be redirected to payment gateway after confirming":"You will pay in cash upon delivery"})]}),e.jsxs(f,{display:"flex",gap:2,justifyContent:"flex-end",mt:3,children:[Object.keys(c).length>0&&e.jsx(M,{variant:"contained",color:"success",startIcon:e.jsx(Nt,{}),onClick:Z,children:"Save Order"}),a.status===R.PENDING&&Object.keys(c).length===0&&e.jsx(M,{variant:"contained",color:"primary",startIcon:e.jsx(_e,{}),onClick:()=>s("payment","Are you sure you want to process the payment for this order?"),children:"Process Payment"}),a&&(a.status===R.PENDING||a.status===R.PROCESSING)&&e.jsx(M,{variant:"contained",color:"warning",onClick:()=>s("cancel","Are you sure you want to cancel this order?"),children:"Cancel Order"}),a&&a.status===R.SHIPPING&&e.jsx(M,{variant:"contained",color:"secondary",onClick:()=>s("delivery","Are you sure you want to mark this order as delivered?"),children:"MARK AS DELIVERED"})]})]}),a&&a.status!==R.PENDING&&e.jsx(H,{sx:{mt:3},children:e.jsx(Ot,{orderId:t||""})}),e.jsxs(Ee,{open:S,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(qe,{id:"alert-dialog-title",children:"Confirm Action"}),e.jsx(He,{children:e.jsx(it,{id:"alert-dialog-description",children:O})}),e.jsxs(Ye,{children:[e.jsx(M,{onClick:u,children:"Cancel"}),e.jsx(M,{onClick:g,autoFocus:!0,children:"Confirm"})]})]}),Object.keys(c).length>0&&e.jsx(te,{sx:{position:"fixed",bottom:16,right:16,p:2,backgroundColor:d.palette.grey[200],zIndex:1e3,border:"1px solid",borderColor:d.palette.grey[300],borderRadius:d.shape.borderRadius},children:e.jsx(n,{variant:"body2",color:"black",children:"You have unsaved changes"})}),e.jsx(Qe,{})]})};export{cr as default};
