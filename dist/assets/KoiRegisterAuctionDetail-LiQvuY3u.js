import{F as ne,l as e,ax as oe,ar as ce,T as P,g as s,ay as le,az as de,B as Y,q as re,a9 as ue,aj as ae,am as J,L as ie,Q as me,a1 as X,z as L,a0 as xe,t as he,a4 as pe}from"./index-D5S7yFe7.js";import{K as fe}from"./KoiInAuctionGrid-BN5g0d89.js";import{b as be}from"./colorUtils-ByJEa9lO.js";import{g as ge}from"./dateTimeUtils-BcV6LRrk.js";import{C as Z}from"./CrudButtonComponent-CR0n4c-B.js";import{T as Ne,B as je}from"./tableHeader-CX8AW8nn.js";import{g as ye,e as ee}from"./dataConverter-CpEqXCMb.js";import{P as Ee}from"./PaginationComponent-Bih5q0F1.js";import{C as Se}from"./ClickAwayListener-DS9BUMYZ.js";import{f as S}from"./currencyUtils-DiCxv8hG.js";import{B as te}from"./Box-BhEgB52r.js";import{T as O,F as V}from"./TextField-CsRXday1.js";import{M as H}from"./MenuItem-DhLzwMG1.js";import{f as se}from"./breeder.apis-DXzJ3kYu.js";import{p as ve,f as we}from"./auctionkoi.apis-C8y8XRS3.js";import{A as Pe}from"./Alert-qDdGi1aw.js";import{f as Ce}from"./auction.apis-D8_4Cf75.js";import{f as Ie}from"./koi.apis-DSE_Wj2w.js";import"./KoiDetails-CfUXS_ks.js";import"./useBreeders-DfW8tSwm.js";import"./orders.type-CY8k0T_M.js";import"./format-BOZTN9QO.js";import"./Select-DtV6tKvQ.js";import"./useFormControl-UCy3dLy1.js";import"./dividerClasses-C6h65s1S.js";import"./environment-ynMLDg3_.js";const De=ne(e.jsx("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline"),Ae=({open:o,onClose:y,anchorEl:h})=>e.jsx(oe,{open:o,anchorEl:h,placement:"right-start",style:{zIndex:1500,width:"500px"},children:e.jsx(Se,{onClickAway:y,children:e.jsxs(ce,{className:"p-6 bg-white rounded-lg shadow-md",sx:{width:"100%",position:"relative",outline:"none",marginTop:"8px"},children:[e.jsx(P,{variant:"h6",className:"mb-4 font-bold text-gray-800",children:"Registration Rules"}),e.jsx("p",{className:"mb-2 font-bold text-gray-600",children:"- Base price must be greater than or equal to Koi's original base price"}),e.jsx("p",{className:"mb-2 font-bold text-gray-600",children:"- Base price must not be greater than 50.000.000 VND"}),e.jsx("hr",{className:"my-2"}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-600",children:[e.jsx("li",{className:"font-bold",children:"For Ascending Bid & Descending Bid Methods:"}),e.jsx("p",{children:"- Bid step must be at least 50.000 VND."}),e.jsx("p",{children:"- Ceiling price is required & greater than base price + 10 times of bid step."})]}),e.jsxs("ul",{className:"list-disc pl-6 space-y-2 text-gray-600 mt-4",children:[e.jsx("li",{className:"font-bold",children:"For Fixed Price Bid Method:"}),e.jsx("p",{children:"- Bid step and ceiling price not required."})]}),e.jsx("hr",{className:"my-4"}),e.jsx(P,{variant:"body2",className:"mt-2 text-green-600",children:"Note: We will charge 10% of the base price as a service fee, please check this info clearly before submitting your auction. You cannot undo after submitting."})]})})}),G=5e4,$=5e7,q={pattern:"\\d*",onKeyDown:o=>{o.ctrlKey&&o.key==="a"||!/[0-9]/.test(o.key)&&o.key!=="Backspace"&&o.key!=="ArrowLeft"&&o.key!=="ArrowRight"&&o.preventDefault()}},_e=({open:o,onClose:y,koiId:h,auctionId:c,basePrice:d,onSubmit:C})=>{const[l,A]=s.useState(""),[a,_]=s.useState(""),[i,R]=s.useState("ASCENDING_BID"),[E,k]=s.useState(""),[p,u]=s.useState(""),[n,m]=s.useState(""),[v,I]=s.useState(""),[B,f]=s.useState(""),[b,g]=s.useState(!1),[M,K]=s.useState(null),T=(t,N)=>{const x=t.target.value,j=U=>{const D=U===""?0:Number(U);if(D<0)return I("Ceil Price must be greater than 0."),!1;switch(N){case"basePrice":return D<d?(m(`Price must be greater than or equal to the original price of ${S(d)}.`),!1):D>$?(m(`Price cannot exceed ${S($)}.`),!1):(m(""),!0);case"bidStep":return i!=="FIXED_PRICE"&&D<G?(u(`Bid step must be at least ${S(G)}.`),!1):(u(""),!0);case"ceilPrice":if(i==="FIXED_PRICE")return I(""),!0;const z=a===""?0:Number(a),Q=l===""?0:Number(l);return D>0&&D<z+10*Q?(I(`Ceiling price must be greater than ${S(z+10*Q)} (base price + 10 times of bid step).`),!1):(i==="ASCENDING_BID"||i==="DESCENDING_BID")&&D===0?(I(`Ceiling price is required for ${i} bid method.`),!1):(I(""),!0);default:return!0}};switch(N){case"basePrice":_(x),j(x);break;case"bidStep":A(x),j(x);break;case"ceilPrice":k(x),j(x);break}};s.useEffect(()=>{const t=l===""?0:Number(l),N=a===""?0:Number(a);i!=="FIXED_PRICE"&&t<G?u(`Bid step must be at least ${S(G)}.`):t>=N?u("Bid step must be less than base price."):u("")},[l,i]),s.useEffect(()=>{const t=a===""?0:Number(a);t<d?m(`Price must be greater than or equal to the original price of ${S(d)}.`):t>$?m(`Price cannot exceed ${S($)}.`):m("")},[a,d]),s.useEffect(()=>{const t=a===""?0:Number(a);if(!n&&t>=d){const N=Math.floor(t*.1);f(`*We will charge 10% of the base price (${S(N)}) as registration fee.*`)}else f("")},[a,n,d]);const W=()=>{const t=a===""?0:Number(a),N=l===""?0:Number(l),x=E===""?0:Number(E);i==="FIXED_PRICE"?n||C(t,0,i,0):!p&&!n&&!v&&C(t,N,i,x)},F=t=>{K(t.currentTarget),g(!0)},r=()=>{g(!1),K(null)},w=t=>{R(t),t==="FIXED_PRICE"&&(A("0"),k("0"))};return e.jsx(le,{open:o,onClose:y,children:e.jsxs(te,{sx:{padding:4,background:"#fff",borderRadius:2,maxWidth:500,margin:"auto",marginTop:"100px",boxShadow:3,position:"relative"},children:[e.jsx("div",{onMouseEnter:F,onMouseLeave:r,style:{position:"absolute",right:"16px",top:"16px",cursor:"pointer"},children:e.jsxs(P,{variant:"body2",color:"textSecondary",className:"font-bold",children:["Rules of registration Â ",e.jsx(de,{title:"Rules",children:e.jsx(De,{color:"primary"})})]})}),b&&M&&e.jsx(Ae,{open:b,onClose:()=>g(!1),anchorEl:M}),e.jsx(P,{variant:"h6",component:"h2",gutterBottom:!0,children:"Register Koi for Auction"}),e.jsxs(P,{variant:"body2",color:"textSecondary",children:["Koi ID: ",h]}),e.jsxs(P,{variant:"body2",color:"textSecondary",children:["Auction ID: ",c]}),e.jsxs(O,{label:"Bid Method",select:!0,variant:"outlined",fullWidth:!0,margin:"normal",value:i,onChange:t=>w(t.target.value),children:[e.jsx(H,{value:"ASCENDING_BID",children:"Ascending Bid"}),e.jsx(H,{value:"DESCENDING_BID",children:"Descending Bid"}),e.jsx(H,{value:"FIXED_PRICE",children:"Fixed Price"})]}),e.jsx(O,{label:"Base Price (VND)",type:"number",variant:"outlined",fullWidth:!0,margin:"normal",value:a,onChange:t=>T(t,"basePrice"),placeholder:"Enter base price (VND)",error:!!n,inputProps:q}),n&&e.jsx(V,{error:!0,children:n}),B&&Number(a)>=d&&e.jsx(V,{sx:{color:"green"},children:B}),e.jsx(O,{label:"Bid Step (VND)",type:"number",variant:"outlined",fullWidth:!0,margin:"normal",value:l,onChange:t=>T(t,"bidStep"),placeholder:"Enter bid step (VND)",error:!!p,disabled:i==="FIXED_PRICE",inputProps:q}),p&&e.jsx(V,{error:!0,children:p}),e.jsx(O,{label:"Ceiling Price (VND)",type:"number",variant:"outlined",fullWidth:!0,margin:"normal",value:E,onChange:t=>T(t,"ceilPrice"),placeholder:"Enter ceiling price (VND)",disabled:i==="FIXED_PRICE",error:!!v,inputProps:q}),v&&e.jsx(V,{error:!0,children:v}),e.jsxs(te,{sx:{display:"flex",justifyContent:"space-between",marginTop:2},children:[e.jsx(Y,{variant:"contained",color:"success",sx:{":hover":{backgroundColor:"#4caf50"}},onClick:W,disabled:i==="FIXED_PRICE"?!!n:!!p||!!n||!!v,children:"Submit"}),e.jsx(Y,{variant:"contained",color:"error",sx:{":hover":{backgroundColor:"#f44336"}},onClick:y,children:"Cancel"})]})]})})},ke=({auction_id:o,onKoiRegistered:y})=>{var F;const[h,c]=s.useState([]),[d,C]=s.useState(!0),[l,A]=s.useState(null),[a,_]=s.useState(0),i=re(),[R,E]=s.useState(0),[k,p]=s.useState(0),u=8,[n,m]=s.useState(null),[v,I]=s.useState(!1),[B,f]=s.useState(!1),b=ue(),g=ae("user_id");if(s.useEffect(()=>{(!b||!g)&&i("/notfound")},[b,g,i]),!b||!g)return null;s.useEffect(()=>{(async()=>{C(!0);try{const t=await se(parseInt(g),a,u);if(t&&Array.isArray(t.item))c(t.item),E(t.total_item),p(t.total_page);else throw new Error("Unexpected data structure from API")}catch(w){const t=ee(w,X.FETCH_KOI_ERROR);A(t),L.error(t)}finally{C(!1)}})()},[a,u,b,g]);const M=(r,w)=>{_(w)},K=r=>{i(`/kois/${r}`)},T=r=>{m(r),f(!0)},W=async(r,w,t,N)=>{if(!n||!o){L.error(X.SELECT_KOI_AND_AUCTION);return}try{const x=await ve(n,o,r,w,t,N,b);L.success(xe.REGISTER_KOI_SUCCESS),f(!1);const j=await se(parseInt(g),a,u);j&&Array.isArray(j.item)&&(c(j.item),p(j.total_page)),setTimeout(()=>{y==null||y()},5e3)}catch(x){const j=ee(x,X.REGISTER_KOI_FAILED);L.error(j)}};return d?e.jsx(J,{className:"flex justify-center items-center h-screen",children:e.jsx(ie,{})}):l?e.jsx(J,{className:"mt-4",children:e.jsx(Pe,{severity:"error",children:l})}):e.jsxs("div",{className:"w-full overflow-x-auto p-10",children:[e.jsx("div",{children:e.jsxs(P,{variant:"h4",className:"mb-4",children:["Total koi not in auction: ",R]})}),e.jsx("div",{className:"overflow-hidden px-4 py-4 sm:-mx-8 sm:px-8",children:e.jsxs("div",{className:"inline-block min-w-full overflow-hidden rounded-lg shadow",children:[e.jsxs("table",{className:"min-w-full leading-normal",children:[e.jsx(Ne,{headers:je}),e.jsx("tbody",{children:h.length>0?h.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.id||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.name||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.sex||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.length||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.year_born||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"h-30 w-10 flex-shrink-0",children:e.jsx("img",{className:"h-full w-full rounded-full object-cover",src:r.thumbnail,alt:r.thumbnail})})})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:S(r.base_price)||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:r.status_name||"N/A"})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsx("p",{className:"whitespace-no-wrap text-gray-900",children:ye(r.category_id)})}),e.jsx("td",{className:"border-b border-gray-200 bg-white px-5 py-5 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{onClick:()=>K(r.id),ariaLabel:"View",svgPath:"view.svg"}),e.jsx(Z,{onClick:()=>T(r.id),ariaLabel:"Push",svgPath:"approve.svg"})]})})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"border-b border-gray-200 bg-white px-5 py-5 text-lg text-center text-red-500",children:"No verified kois found."})})})]}),e.jsx("div",{className:"flex gap-4 justify-center",children:e.jsx(_e,{open:B,onClose:()=>f(!1),koiId:n??0,auctionId:o??0,basePrice:(F=h.filter(r=>r.id===n)[0])==null?void 0:F.base_price,onSubmit:W})}),e.jsx("div",{className:"xs:flex-row xs:justify-between flex flex-col items-center border-t bg-white px-5 py-5",children:e.jsx(Ee,{totalPages:k,currentPage:a,onPageChange:M})})]})}),e.jsx(me,{})]})},it=()=>{const{isLoggedIn:o,user:y}=he(),{id:h}=pe(),[c,d]=s.useState(null),[C,l]=s.useState([]),[A,a]=s.useState(!0),[_,i]=s.useState(null),R=re(),E=ae("access_token"),[k,p]=s.useState(0);return s.useEffect(()=>{if(!E)return;(async()=>{a(!0);try{const n=await Ce(Number(h));if(n){d(n);const m=await we(n.id);if(m){const v=m.map(f=>Ie(f.koi_id)),B=(await Promise.all(v)).map((f,b)=>({...f,auctionKoiData:m[b]}));l(B)}}else i("No Upcoming Auction Found.")}catch{i("Error fetching auction data.")}finally{a(!1)}})()},[h,E,k]),A?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(ie,{})}):_?e.jsx("div",{className:"py-8 text-center text-red-500",children:_}):c?(E||R("/login"),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col mt-2",children:[e.jsxs("div",{className:"flex flex-col sm:flex-col items-start pl-6 ml-5 mt-5",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-xl text-black",children:"Auction Name: "}),e.jsx("h2",{className:"text-2xl font-semibold text-black",children:c.title})]}),e.jsx("div",{className:"",children:e.jsxs("span",{className:`rounded-lg px-4 py-2 text-lg font-bold ${be(c.status)}`,children:["Status: ",c.status]})}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-xl text-black",children:"Start Time: "}),e.jsx("span",{className:"text-xl text-black glow-text",children:c.start_time.toString()})]}),e.jsxs("div",{className:"mt-5",children:[e.jsx("label",{className:"text-xl text-black",children:"End Time: "}),e.jsx("span",{className:"text-xl text-black glow-text",children:c.end_time.toString()})]}),e.jsx("div",{className:" mt-5",children:e.jsx("span",{className:"text-xl text-black glow-text",children:ge(c.start_time.toString(),c.end_time.toString())})})]}),e.jsxs(P,{variant:"h4",className:"text-center mt-5",children:["*Note: This koi is already registered in the ",c.title,"."]}),e.jsx(fe,{kois:C,auction:c}),e.jsx(ke,{auction_id:c.id,onKoiRegistered:()=>p(u=>u+1)})]})})):e.jsx("div",{className:"py-8 text-center text-red-500",children:"No Upcoming Auction Found."})};export{it as default};
