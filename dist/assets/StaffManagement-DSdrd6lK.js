import{a2 as D,a3 as N,al as O,a1 as y,ai as K,g as s,j as L,k as e,aJ as k,aK as z,aL as R,C as Q,aM as I,B as T,aB as P,x as b,b4 as q,L as V,b2 as $,$ as B,T as X,Q as Z,b6 as ee}from"./index-CWISwWJd.js";import{C as te,A as ae}from"./CustomButton-B9ybxgck.js";import{P as se}from"./PaginationComponent-KRv-3E9a.js";import{C as W}from"./CrudButtonComponent-wxVkr_OK.js";import{T as re,S as ne}from"./tableHeader-Cup3WGTs.js";import{e as F}from"./dataConverter-XHHqu_XV.js";import{F as le,I as oe,S as ie}from"./Select-DWOTwv4U.js";import{M as ce}from"./MenuItem-DoRT03Py.js";import{S as Y}from"./Snackbar-ChaLQSwl.js";import{B as A}from"./Box-CXrrZtx3.js";import{T as v}from"./TextField-BE1Be_bw.js";import"./dateTimeUtils-CQFQMvEL.js";import"./format-BOZTN9QO.js";import"./useFormControl-BPgDhIut.js";import"./dividerClasses-Ck80DuqL.js";import"./ClickAwayListener-DylQPNoX.js";const de=async(l,n)=>{try{if((await D.delete(`${N}/staffs/${l}`,{headers:{Authorization:`Bearer ${n}`}})).status!==200)throw new Error("Failed to delete staff")}catch(i){O(i,y.DELETE_STAFF_ERROR,!1,y.DELETE_STAFF_ERROR)}},ue=async(l,n,i)=>{try{if((await D.put(`${N}/staffs/${l}`,n,{headers:{Authorization:`Bearer ${i}`}})).status!==200)throw new Error("Failed to update staff")}catch(t){O(t,y.UPDATE_STAFF_ERROR,!1,y.UPDATE_STAFF_ERROR)}},me=async l=>{try{const n=await D.get(`${N}/staffs/${l}`,{headers:{Authorization:`Bearer ${K()}`}});if(n.status!==200)throw new Error("Failed to fetch staff data");return n.data}catch(n){O(n,y.FETCH_STAFF_ERROR,!1,y.FETCH_STAFF_ERROR)}};function he({apiUrl:l,itemsPerPage:n,accessToken:i}){const[t,g]=s.useState([]),[h,x]=s.useState(!0),[j,p]=s.useState(null),[c,_]=s.useState(1),[E,S]=s.useState(0),[C,d]=s.useState(0),f=s.useCallback(async()=>{try{x(!0);const a=i?{Authorization:`Bearer ${i}`}:{},m=(await D.get(l,{params:{page:c-1,limit:n},headers:a})).data;m&&Array.isArray(m.item)?(g(m.item),S(m.total_item),d(m.total_page),p(null)):p("Error fetching items")}catch{p("Error fetching items")}finally{x(!1)}},[l,c,n,i]);return s.useEffect(()=>{f()},[f]),{items:t,loading:h,error:j,page:c,totalItems:E,totalPages:C,handlePageChange:(a,o)=>{_(o)},refetch:f}}const xe=({open:l,onClose:n,onInputChange:i})=>{const[t,g]=s.useState([]),[h,x]=s.useState(""),[j,p]=s.useState(!1),[c,_]=s.useState(!1),[E,S]=s.useState(""),C=L(),d=async()=>{const a=P("access_token");if(!a){C("/login");return}p(!0);try{const o=await D.get(`${N}/members`,{headers:{Authorization:`Bearer ${a}`},params:{page:0,limit:50}});g(o.data.item)}catch(o){console.error("Error fetching staff list:",o)}finally{p(!1)}},f=async a=>{if(a&&a.preventDefault(),!h){b.error("Please select a member before submitting");return}try{await q(parseInt(h),2),S("Member updated to staff successfully"),_(!0),n()}catch(o){const m=F(o,"Failed to update member to staff");console.error(m),b.error(m)}};s.useEffect(()=>{l&&d()},[l]);const u=a=>{x(a.target.value),i("auctioneer_id",a.target.value)};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{open:l,onClose:n,maxWidth:"sm",fullWidth:!0,children:[e.jsx(z,{children:"Update Current Member to Staff"}),e.jsxs(R,{children:[e.jsxs(le,{fullWidth:!0,variant:"standard",margin:"dense",children:[e.jsx(oe,{id:"auctioneer-select-label",children:"Member"}),e.jsx(ie,{labelId:"auctioneer-select-label",id:"auctioneer-select",name:"auctioneer_id",value:h,onChange:u,label:"Auctioneer",children:t.map(a=>e.jsx(ce,{value:a.id,children:`ID: ${a.id} - ${a.first_name} ${a.last_name}`},a.id))})]}),j&&e.jsx(Q,{})]}),e.jsxs(I,{children:[e.jsx(T,{onClick:n,children:"Cancel"}),e.jsx(T,{onClick:a=>f(a),variant:"contained",color:"primary",disabled:j,children:j?"Submitting...":"Submit"})]})]}),e.jsx(Y,{open:c,autoHideDuration:6e3,onClose:()=>_(!1),message:E})]})},H={readOnly:!0},pe=({open:l,onClose:n,staffId:i})=>{const[t,g]=s.useState(null),[h,x]=s.useState(!0),[j,p]=s.useState(null),[c,_]=s.useState({open:!1,message:""}),E=L();s.useEffect(()=>{l&&C()},[l,i]);const S=()=>{const u=P("access_token");return u||(E("/notfound"),null)},C=async()=>{if(x(!0),!!S())try{const a=await me(i);g(a)}catch(a){const o=F(a,"Failed to fetch staff data");b.error(o),p(o)}finally{x(!1)}},d=u=>{const{name:a,value:o}=u.target;g(m=>m?{...m,[a]:o}:null)},f=async()=>{if(!t)return;const u=S();if(u)try{await ue(i,t,u),_({open:!0,message:"Staff updated successfully"}),n()}catch(a){const o=F(a,"Failed to update staff");b.error(o),p(o)}};return h?e.jsx(k,{open:l,onClose:n,children:e.jsx(R,{children:e.jsx(A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:200},children:e.jsx(V,{})})})}):j?e.jsxs(k,{open:l,onClose:n,children:[e.jsx(R,{children:e.jsx(A,{sx:{color:"error.main"},children:j})}),e.jsx(I,{children:e.jsx(T,{onClick:n,children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(k,{open:l,onClose:n,maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:"Edit Staff Member"}),e.jsx(R,{children:e.jsxs(A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[e.jsxs(A,{sx:{display:"flex",gap:2},children:[e.jsx(v,{name:"first_name",label:"First Name",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.first_name)??"",onChange:d}),e.jsx(v,{name:"last_name",label:"Last Name",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.last_name)??"",onChange:d})]}),e.jsxs(A,{sx:{display:"flex",gap:2},children:[e.jsx(v,{name:"email",label:"Email Address",type:"email",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.email)??"",onChange:d,inputProps:H}),e.jsx(v,{name:"phone_number",label:"Phone Number",type:"tel",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.phone_number)??"",onChange:d,inputProps:H})]}),e.jsx(v,{name:"address",label:"Address",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.address)??"",onChange:d}),e.jsxs(A,{sx:{display:"flex",gap:2},children:[e.jsx(v,{name:"date_of_birth",label:"Date of Birth",type:"date",fullWidth:!0,variant:"outlined",InputLabelProps:{shrink:!0},value:(t==null?void 0:t.date_of_birth)??"",onChange:d}),e.jsx(v,{name:"avatar_url",label:"Avatar URL",type:"text",fullWidth:!0,variant:"outlined",value:(t==null?void 0:t.avatar_url)??"",onChange:d})]})]})}),e.jsxs(I,{children:[e.jsx(T,{onClick:n,children:"Cancel"}),e.jsx(T,{onClick:f,variant:"contained",color:"primary",children:"Update"})]})]}),e.jsx(Y,{open:c.open,autoHideDuration:6e3,onClose:()=>_({...c,open:!1}),message:c.message})]})},Re=()=>{const[l,n]=s.useState(!1),[i,t]=s.useState(!1),[g,h]=s.useState(null),x=L(),[j,p]=s.useState({first_name:"",last_name:"",phone_number:"",email:"",password:"",is_active:!0,is_subscription:!0,address:"",date_of_birth:"",avatar_url:""}),c=P("access_token");s.useEffect(()=>{c||x("/notfound")},[c,x]);const{items:_,page:E,totalPages:S,totalItems:C,handlePageChange:d,refetch:f}=he({apiUrl:`${N}/staffs`,itemsPerPage:20,accessToken:c});if(!c)return null;const u=s.useCallback(async r=>{if(window.confirm(`${$.ARE_YOU_SURE_YOU_WANT_TO_DELETE_THIS_STAFF}?`))try{await de(r,c),b.success(B.DELETE_STAFF_SUCCESS),f()}catch(w){const M=F(w,y.DELETE_STAFF_FAILED);b.error(M)}},[c,f]),a=async r=>{if(confirm(`${$.ARE_YOU_SURE_YOU_WANT_TO_REDO_THIS_STAFF} ${r}`))try{await ee(r),b.success(B.REDO_STAFF_SUCCESS)}catch(w){const M=F(w,y.REDO_STAFF_FAILED);b.error(M)}};s.useCallback(r=>{h(r),t(!0)},[]);const o=s.useCallback(()=>{t(!1),h(null)},[]),m=s.useCallback(()=>n(!0),[]),G=s.useCallback(()=>n(!1),[]),J=(r,U)=>{};return e.jsxs("div",{className:"m-5 overflow-x-auto",children:[e.jsxs("div",{className:"mb-6 flex justify-between",children:[e.jsx("div",{className:"border-2 border-sky-500 p-6 rounded-xl",children:e.jsxs(X,{variant:"h5",children:["Total Staff: ",C]})}),e.jsxs(te,{onClick:m,children:[e.jsx(ae,{className:"mr-2"}),"New Staff"]})]}),e.jsx(xe,{open:l,onClose:G,onInputChange:J}),e.jsxs("table",{className:"whitespace-no-wrap w-full",children:[e.jsx(re,{headers:ne}),e.jsxs("tbody",{className:"divide-y bg-white dark:divide-gray-700 dark:bg-gray-800",children:[_.map(r=>e.jsxs("tr",{className:"text-gray-700 dark:text-gray-400",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:r.id}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex items-center text-sm",children:e.jsx("div",{className:"relative mr-3 hidden h-8 w-8 rounded-full md:block",children:e.jsx("img",{className:"h-full w-full rounded-full object-cover",src:r.avatar_url,alt:"",loading:"lazy"})})})}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[r.first_name," ",r.last_name]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.phone_number||"Not provided"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.address}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.status_name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.is_active}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.is_subscription}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.date_of_birth}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.account_balance}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.auction_count}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.created_at}),e.jsx("td",{className:"px-4 py-3 text-sm",children:r.updated_at}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsx(W,{onClick:()=>u(r.id),ariaLabel:"Delete",svgPath:"delete.svg"}),e.jsx(W,{onClick:()=>a(r.id),ariaLabel:"Redo breeder",svgPath:"redo.svg"})]})})]},r.id)),g&&e.jsx(pe,{open:i,onClose:o,staffId:g})]})]}),e.jsx("div",{className:"xs:flex-row xs:justify-between flex flex-col items-center border-t bg-white px-5 py-5",children:e.jsx(se,{totalPages:S,currentPage:E,onPageChange:d})}),e.jsx(Z,{})]})};export{Re as default};
