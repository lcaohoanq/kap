import{I as R,H as D,g as u,J as U,l as e,P as $,N as k,V as P,T as B,X as L,aj as b,as as V,at as M,au as O,B as z,k as y,a2 as w,z as A}from"./index-D5S7yFe7.js";import{A as W}from"./Alert-qDdGi1aw.js";import{e as Y}from"./regex-DBRfaSZx.js";import{I as d}from"./Select-DtV6tKvQ.js";import{T as m}from"./TextField-CsRXday1.js";function q(t){return R("MuiAlertTitle",t)}D("MuiAlertTitle",["root"]);const H=t=>{const{classes:l}=t;return P({root:["root"]},q,l)},J=$(B,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(t,l)=>l.root})(L(({theme:t})=>({fontWeight:t.typography.fontWeightMedium,marginTop:-2}))),X=u.forwardRef(function(l,o){const x=U({props:l,name:"MuiAlertTitle"}),{className:p,..._}=x,f=x,g=H(f);return e.jsx(J,{gutterBottom:!0,component:"div",ownerState:f,ref:o,className:k(g.root,p),..._})}),ae=({user:t})=>!t||t.status_name==="VERIFIED"?null:e.jsxs(W,{severity:"warning",className:"verify-alert mb-5",children:[e.jsx(X,{children:"Account Not Verified"}),"Your account is not verified. Please verify your account to access all features."]}),se=({openModal:t,handleClose:l})=>{const[o,x]=u.useState(null),[p,_]=u.useState(!0),[f,g]=u.useState({}),[F,N]=u.useState(new Set),[i,T]=u.useState({first_name:"",last_name:"",email:"",phone_number:"",address:"",status:"",date_of_birth:"",avatar_url:"",google_account_id:0,balance_account:0}),E=a=>a?Y.test(a)?"":"Invalid email format":"Email is required",S=a=>!a||a.trim()===""||/^(?:\+84|0084|0)[235789][0-9]{1,2}[0-9]{7}$/.test(a.trim())?"":"Invalid phone number format (must be in Vietnamese format +84xxxxxxxxx or 0xxxxxxxxx)",C=(a,r)=>{switch(a){case"email":return E(r);case"phone_number":return S(r);default:return""}};u.useEffect(()=>{if(t){const a=b("user_id");(async()=>{try{const s=await y.get(`${w}/users/${a}`);x(s.data),T({first_name:s.data.first_name||"",last_name:s.data.last_name||"",email:s.data.email||"",phone_number:s.data.phone_number||"",password:"",confirm_password:"",address:s.data.address||"",status:s.data.status_name,date_of_birth:s.data.date_of_birth||"",avatar_url:s.data.avatar_url||"",google_account_id:s.data.google_account_id||0,balance_account:s.data.account_balance||0}),g({}),N(new Set),_(!1)}catch(s){console.error("Error fetching user data:",s),_(!1)}})()}},[t]);const c=a=>{const{name:r,value:s}=a.target;if(T(n=>({...n,[r]:s})),N(n=>new Set(n).add(r)),F.has(r)){const n=C(r,s);g(h=>({...h,[r]:n}))}},I=async()=>{var r,s;const a={};if(Object.entries(i).forEach(([n,h])=>{if(typeof h=="string"){const j=C(n,h);j&&(a[n]=j)}}),Object.keys(a).length>0){g(a),N(new Set(Object.keys(a))),A.error("Please fix the validation errors before saving");return}try{const n=b("user_id"),h=b("access_token"),j={...i,phone_number:i.phone_number.trim()};await y.put(`${w}/users/details/${n}`,j,{headers:{Authorization:`Bearer ${h}`}}),A.success("User details updated successfully"),l()}catch(n){y.isAxiosError(n)&&A.error(((s=(r=n.response)==null?void 0:r.data)==null?void 0:s.reason)||"An error occurred")}},v=a=>F.has(a)&&f[a]||"";return e.jsxs(V,{open:t,onClose:l,children:[e.jsx(M,{className:"text-center",children:p?"Loading...":`Update for ${o==null?void 0:o.role_name} ${o==null?void 0:o.first_name} ${o==null?void 0:o.last_name}`}),e.jsx(O,{className:"sm:max-w-[500px] lg:max-w-[600px]",children:!p&&e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"first_name",className:"text-right",children:"First Name"}),e.jsx(m,{id:"first_name",name:"first_name",value:i.first_name,onChange:c,className:"col-span-5"})]}),e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"last_name",className:"text-right",children:"Last Name"}),e.jsx(m,{id:"last_name",name:"last_name",value:i.last_name,onChange:c,className:"col-span-5"})]}),e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(m,{id:"email",name:"email",type:"email",value:i.email,onChange:c,error:!!v("email"),helperText:v("email"),className:"col-span-5"})]}),e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"phone_number",className:"text-right",children:"Phone"}),e.jsx(m,{id:"phone_number",name:"phone_number",value:i.phone_number,onChange:c,error:!!v("phone_number"),helperText:v("phone_number"),className:"col-span-5",placeholder:"Enter phone number (optional)"})]}),e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"address",className:"text-right",children:"Address"}),e.jsx(m,{id:"address",name:"address",value:i.address,onChange:c,className:"col-span-5"})]}),e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"date_of_birth",className:"text-right",children:"Birth Date"}),e.jsx(m,{id:"date_of_birth",name:"date_of_birth",type:"date",value:i.date_of_birth,onChange:c,className:"col-span-5"})]}),e.jsxs("div",{className:"grid grid-cols-6 items-center gap-4",children:[e.jsx(d,{htmlFor:"avatar_url",className:"text-right",children:"Avatar URL"}),e.jsx(m,{id:"avatar_url",name:"avatar_url",value:i.avatar_url,onChange:c,className:"col-span-5"})]}),e.jsx(z,{variant:"contained",onClick:I,className:"w-full mt-4",children:"Save Changes"})]})})]})};export{ae as A,se as U};
