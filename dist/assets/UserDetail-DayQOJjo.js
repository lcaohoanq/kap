import{t as y,D as C,ai as q,a2 as z,aq as W,g as a,j as G,k as e,a4 as M,ax as I,T as K,a6 as N,aA as Q,aB as h,aC as S,B as w,Q as X,x as f}from"./index-CvZ0wdb0.js";import{A as Y}from"./AccountTransactionComponent-CzQPIJdX.js";import{A as H,U as J}from"./UserDetailDialog-BXLR1YEG.js";import{f as Z}from"./currencyUtils-DiCxv8hG.js";import{e as ee}from"./dataConverter-DNxSg1bu.js";import{a as se}from"./dateTimeUtils-CQFQMvEL.js";import{a as te}from"./otp.apis-B6A-zPJ7.js";import{D as A}from"./Divider-B5cCF6n7.js";import{F as re,I as ae,S as oe}from"./Select-D5OM6xxo.js";import{M as _}from"./MenuItem-4CYdLiSI.js";import{T as ne}from"./TextField-DmIMr6K4.js";import"./payment.apis-Dv3GJbEk.js";import"./Alert-CGMiffud.js";import"./Chip-BEWcYvbG.js";import"./Box-CMC4TlbO.js";import"./regex-DBRfaSZx.js";import"./format-BOZTN9QO.js";import"./dividerClasses-D9IiBztf.js";import"./useFormControl-Cz7kLNRm.js";const le=async(s,d)=>{var u,o;try{return(await y.post(`${C}/mail/update-role?updateRole=${s}`,{purpose:d},{headers:{Authorization:`Bearer ${q()}`}})).data}catch(i){if(y.isAxiosError(i)){const c=((o=(u=i.response)==null?void 0:u.data)==null?void 0:o.reason)||"An error occurred during send email update role";throw new Error(c)}else throw new Error(z.UNEXPECTED_ERROR)}},we=()=>{const{user:s,loading:d,loading:u,error:o,setUser:i}=W(),[c,p]=a.useState(!1),[j,x]=a.useState(!1),[E,g]=a.useState(),m=G(),[v,R]=a.useState(!0),[l,ce]=a.useState(!0),[k,b]=a.useState({type:null,loading:!1}),D=()=>R(!v);if(u)return e.jsx(M,{});if(o)return e.jsxs("div",{children:["Error: ",o]});if(!s)return e.jsx("div",{children:"No user data found"});s.role_name!==I.MEMBER&&m("/notfound");const F=async()=>{const t=h("user_id"),n=h("access_token");if(!t||!n){m("/notfound");return}b({type:"update",loading:!0});try{const r=await y.get(`${C}/users/${t}`,{headers:{Authorization:`Bearer ${n}`}});g(r.data),x(!0)}catch(r){console.error("Failed to fetch user data",r),f.error("Failed to fetch user data")}finally{b({type:null,loading:!1})}},T=()=>{x(!1)};if(d)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(M,{})});const U=async()=>{if(s){b({type:"verify",loading:!0});try{(await te(s.email)).status===200?m("/otp-verification",{state:{email:s.email,from:"userDetail",statusCode:200}}):f.error("Failed to send OTP")}catch{f.error("An error occurred while sending OTP")}finally{b({type:null,loading:!1})}}},B=()=>{p(!0)},$=()=>{p(!1)},P=async(t,n)=>{if(s)try{await le(t,n),f.success("Send Update Role Email Successfully")}catch(r){const V=ee(r,"Error send email update role");f.error(V)}},L=async()=>{try{const t=h("user_id"),n=h("access_token");if(!t||!n){m("/notfound");return}const r=await y.get(`${C}/users/${t}`,{headers:{Authorization:`Bearer ${n}`}});i(r.data)}catch(t){console.error("Failed to refresh user data",t)}},O=(t,n)=>{const r=k.type===t&&k.loading;return e.jsx("button",{onClick:U,disabled:r,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md transition",children:r?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-5 h-5 border-t-2 border-b-2 border-current rounded-full animate-spin mr-2"}),"Loading..."]}):n})};return e.jsxs("div",{className:"container mx-auto mt-12 mb-36",children:[e.jsx(H,{user:s}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg flex flex-col justify-around mr-10 p-6",children:[e.jsxs("div",{className:"flex flex-col justify-start",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:s.avatar_url,alt:`${s.first_name} ${s.last_name}`,className:"mb-4 w-[15rem] rounded-full"})}),s.status_name!=="VERIFIED"&&O("verify",e.jsxs(e.Fragment,{children:[e.jsx(N,{icon:S,className:"mr-2"}),"Verify Account"]}))]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx("h2",{className:"text-2xl text-black",children:"Account Details"}),e.jsx(A,{"aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Email"}),e.jsx("p",{children:s.email})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Phone Number"}),e.jsx("p",{children:s.phone_number||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Address"}),e.jsx("p",{children:s.address||"Not provided"})]}),e.jsx(A,{"aria-hidden":"true"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold",children:"Status"}),e.jsx("p",{children:s.status_name})]})]})]}),e.jsxs("div",{className:" md:col-span-2 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(K,{variant:"h4",children:[s.first_name," ",s.last_name]}),s.status_name==="VERIFIED"&&e.jsx(N,{icon:Q,onClick:F,className:"text-2xl text-gray-400 hover:cursor-pointer"})]}),e.jsx("h2",{className:"text-2xl text-blue-500 mt-5 mb-6",children:s.role_name.charAt(0).toUpperCase()+s.role_name.slice(1)}),s.status_name=="VERIFIED"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-center items-center gap-5",children:[e.jsx("p",{className:"text-xl font-bold mb-5",children:"Account Balance:"}),e.jsx("p",{className:"text-3xl text-green-600 font-bold mb-5",children:s.account_balance!==null?Z(s.account_balance):"No money"})]}),e.jsx(Y,{userId:s.id,token:h("access_token")||"",onTransactionSuccess:L})]}),e.jsxs("div",{className:"text-left",children:[e.jsx(N,{icon:S,className:"mr-2"}),e.jsx(w,{onClick:D,variant:"text",color:"inherit",children:"About Me"}),e.jsx(A,{variant:"fullWidth"})]}),v&&e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-5 justify-between ",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Date of Birth"}),e.jsx("p",{children:s.date_of_birth||"Not Provided"})]}),e.jsxs("div",{className:"flex gap-5 justify-between ",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Created At"}),e.jsx("p",{children:se(s.created_at||"")})]}),e.jsxs("div",{children:[s.status_name==="VERIFIED"&&s.role_name===I.MEMBER&&e.jsxs("button",{onClick:B,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-500 transition",children:[e.jsx(N,{icon:S,className:"mr-2"}),"I want to Update My Role"]}),e.jsx(ie,{isOpen:c,onClose:$,onSubmit:P})]})]})]})]}),e.jsx(J,{openModal:j,handleClose:T}),e.jsx(X,{})]})},ie=({isOpen:s,onClose:d,onSubmit:u})=>{const[o,i]=a.useState(""),[c,p]=a.useState(""),[j,x]=a.useState(!1),[E,g]=a.useState(!1),m=l=>{i(l.target.value),x(!1)},v=l=>{p(l.target.value),g(!1)},R=()=>{let l=!0;o||(x(!0),l=!1),c||(g(!0),l=!1),l&&(u(o,c),d())};return e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center ${s?"":"hidden"}`,children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg w-1/3",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Select Role to Update"}),e.jsxs(re,{fullWidth:!0,variant:"standard",error:j,className:"mb-4",children:[e.jsx(ae,{children:"Select Role"}),e.jsxs(oe,{value:o,onChange:m,label:"Choose a role",required:!0,className:"mb-4",children:[e.jsx(_,{value:"",children:e.jsx("em",{children:"Select Role"})}),e.jsx(_,{value:"BREEDER",children:"Breeder"}),e.jsx(_,{value:"STAFF",children:"Staff"})]}),j&&e.jsx("p",{className:"text-red-500 text-sm",children:"Role is required"})]}),e.jsx(ne,{label:"Purpose",variant:"standard",required:!0,fullWidth:!0,value:c,onChange:v,error:E,helperText:E?"Purpose is required":"",className:"mb-4"}),e.jsxs("div",{className:"flex justify-end gap-3 mt-8",children:[e.jsx(w,{variant:"contained",color:"primary",onClick:R,className:"mr-2",children:"Submit"}),e.jsx(w,{variant:"contained",color:"error",onClick:d,children:"Cancel"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 mt-3",children:"*Note: Please provide a valid reason for updating your role. We will review your request and get back to you as soon as possible."}),e.jsx("p",{className:"text-gray-400 mt-3",children:"Thanks for your patience. From Koi Auction Team."})]})]})})};export{we as default};
